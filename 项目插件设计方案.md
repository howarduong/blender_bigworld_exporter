

## 🗂️ 迁移准备清单

### 1. 源码与文档准备
- [ ] **旧版 Max 插件源码**：完整的 `.ms` 文件（包括 `BigWorld_Common.ms`、UI 脚本、导出器脚本等）。  
- [ ] **旧版文档**：团队内部的使用手册、参数说明、导出流程文档。  
- [ ] **示例资产**：一批能覆盖常见边界情况的 Max 工程文件（含材质、动画、LOD、碰撞体）。  
- [ ] **BigWorld 引擎接口文档**：确认导出文件格式、二进制协议、路径规则。  

### 2. Blender 环境准备
- [ ] **Blender 4.5.3 安装**（确保团队统一版本）。  
- [ ] **Blender Python API 文档**（4.5.3 对应的官方 API）。  
- [ ] **开发环境**：推荐 VSCode + Blender 插件调试工具（`bpy` stub、Blender Development 插件）。  
- [ ] **测试用例资产**：将 Max 示例资产导入 Blender，验证兼容性。  

### 3. 技术映射与对照
- [ ] **字段对照表**：MaxScript 全局变量/函数 ↔ Blender Python 对应实现。  
- [ ] **坐标系映射**：确认 Max → BigWorld → Blender 的坐标转换矩阵。  
- [ ] **单位系统**：Max 的系统单位 ↔ Blender 默认米制。  
- [ ] **UI/UX 对照**：Max rollout 面板 ↔ Blender `bpy.types.Panel`。  
- [ ] **文件导出逻辑**：Max 的 Writer/Validator ↔ Blender Python 文件 IO。  

### 4. 工程架构与规范
- [ ] **插件骨架**：`__init__.py` + 模块化子文件（common、ui、export、validator）。  
- [ ] **命名规范**：统一 Python 命名风格（PEP8），并保留旧版字段别名以兼容。  
- [ ] **Schema/Checklist**：为每个导出参数、错误码、校验规则建立 schema。  
- [ ] **自动化测试**：用 `pytest` 或 Blender 内置测试框架验证导出结果。  
- [ ] **CI/CD**：配置 GitHub Actions 或本地 CI，保证每次提交能跑通导出/验证。  

### 5. 团队协作与迁移策略
- [ ] **任务拆分**：UI、导出器、验证器、路径管理、几何工具，各自独立模块。  
- [ ] **版本控制**：Git 仓库（建议和旧版 Max 插件源码分开存放）。  
- [ ] **文档同步**：迁移过程中更新开发者手册，保证新成员能快速上手。  
- [ ] **回归测试**：每完成一个模块，就用旧版 Max 插件导出的结果对比 Blender 插件导出的结果。  
- [ ] **风险清单**：列出可能的兼容性问题（如材质、动画、骨骼），提前准备验证方案。  

---

## 🚀 建议的启动顺序
1. **建立字段对照表**（Max ↔ Blender），锁定迁移范围。  
2. **搭建插件骨架**（空函数 + TODO），保证能在 Blender 中加载。  
3. **优先迁移路径/导出逻辑**，因为这是整个流程的核心。  
4. **逐步补齐 UI、验证器、几何工具**。  
5. **最后做回归测试**，确保 1:1 复刻。  

---

 **1:1 复刻旧版 Max 插件到 Blender 4.5.3**，那我们需要一个**极其详细的迁移准备清单**，覆盖源码、环境、功能、验证、团队协作等所有环节，避免遗漏。下面我给你一个分层级的 **全景 Checklist**，你们团队可以直接用来分工和推进。

---

# 🗂️ Blender 插件迁移全景清单

## 一、源码与需求准备
- [ ] **收集旧版 Max 插件源码**
  - `BigWorld_Common.ms`
  - 导出器脚本（Writer/Validator）
  - UI 脚本（rollout 面板）
  - 工具脚本（几何检查、材质处理）
- [ ] **收集旧版文档**
  - 参数说明文档
  - 使用手册
  - 开发者注释
- [ ] **收集示例资产**
  - 模型（LOD、多材质、骨骼动画）
  - 场景（含灯光、碰撞体）
  - 特殊边界案例（空材质、非法路径、非流形几何）
- [ ] **收集 BigWorld 引擎接口**
  - 二进制文件格式（.visual, .primitives, .chunk）
  - 路径规则（res、tools、bin）
  - 校验规则（错误码、日志格式）

---

## 二、Blender 环境准备
- [ ] **统一 Blender 版本**：4.5.3  
- [ ] **安装开发工具**
  - VSCode + Blender Development 插件
  - Python stub (`bpy-stubs`)  
- [ ] **配置调试环境**
  - Blender 内置控制台
  - 外部调试 attach（`bpy.app.debug`）
- [ ] **准备测试资产**
  - 将 Max 示例资产导入 Blender（FBX/OBJ/自研转换）

---

## 三、功能映射与对照
- [ ] **全局变量对照**
  - AngleDivergence → ANGLE_DIVERGENCE
  - VertTolerance → VERT_TOLERANCE
  - VertThreshold → VERT_THRESHOLD
  - bwMacroScriptsPath → **废弃**
- [ ] **函数对照**
  - bwCleanPath → bw_clean_path
  - convertCoordinateToBW → convert_coordinate_to_bw
  - convertToMeters → convert_to_meters
  - IsPlanar → is_planar
- [ ] **数据结构对照**
  - Max 全局数组 → Blender `bmesh`/`mesh.vertices`
  - Max rollout UI → Blender `bpy.types.Panel`
  - Max ini 配置 → Blender `addon preferences`
- [ ] **文件导出对照**
  - Max BinaryWriter → Python `struct`/`io`
  - Max Validator → Python schema 校验器

---

## 四、插件架构设计
- [ ] **插件骨架**
  - `__init__.py`（bl_info、注册入口）
  - `common.py`（路径、单位、坐标工具）
  - `export.py`（Writer）
  - `validate.py`（Validator）
  - `ui.py`（面板）
  - `xml_manager.py`（PathsXMLManager）
- [ ] **命名规范**
  - Python PEP8
  - 保留旧版字段别名（兼容迁移文档）
- [ ] **Schema 驱动**
  - 导出参数 schema
  - 错误码 schema
  - 校验规则 schema

---

## 五、功能模块迁移清单
- [ ] **路径管理**
  - bw_clean_path
  - bigworld_folder_dir
  - bigworld_res_dir
  - bw_tools_folder_dir
- [ ] **单位与坐标**
  - convert_to_meters
  - convert_coordinate_to_bw
- [ ] **几何工具**
  - is_planar
  - 顶点/法线/边界检查
- [ ] **导出器**
  - Writer：生成 .visual / .primitives
  - 二进制写入：struct.pack
  - 路径规则：res/tools/bin
- [ ] **验证器**
  - 参数完整性校验
  - 错误码输出
  - 日志格式对齐
- [ ] **UI**
  - 导出面板（参数输入）
  - 路径选择器
  - 错误提示
- [ ] **XML 管理**
  - PathsXMLManager
  - 绝对/相对路径切换
  - XML 写回

---

## 六、测试与验证
- [ ] **单元测试**
  - 路径函数
  - 单位换算
  - 坐标转换
  - XML 管理
- [ ] **集成测试**
  - 导出完整资产
  - 验证导出文件可被 BigWorld 引擎加载
- [ ] **回归测试**
  - 与 Max 插件导出结果逐字节对比
- [ ] **边界测试**
  - 空材质
  - 非流形几何
  - 超大模型
  - 错误路径

---

## 七、团队协作与流程
- [ ] **任务拆分**
  - UI → 前端开发
  - Writer → 核心开发
  - Validator → QA/工具开发
  - 文档 → 技术写手
- [ ] **版本控制**
  - Git 仓库
  - 分支策略（feature/bugfix/release）
- [ ] **CI/CD**
  - GitHub Actions：自动跑测试
  - 自动打包插件 zip
- [ ] **文档同步**
  - 开发者手册
  - 使用手册
  - FAQ
- [ ] **培训与交接**
  - 新成员快速上手指南
  - 代码评审 checklist

---

## 八、风险与预案
- [ ] **坐标系不一致** → 提前验证 BigWorld 坐标映射矩阵  
- [ ] **材质兼容性** → Blender 材质节点 vs Max 材质球  
- [ ] **动画兼容性** → 骨骼/蒙皮导出规则  
- [ ] **文件格式差异** → 二进制写入字节序、对齐方式  
- [ ] **团队习惯差异** → 制定统一编码规范、文档模板  

---

bigworld_blender_addon/
│── __init__.py              # 插件入口
│
├── core/                    # 核心逻辑层
│   ├── common.py             # 公共函数 (BigWorld_Common.ms)
│   ├── xml_manager.py        # 路径 XML 管理
│   ├── geometry.py           # 几何工具 (BigWorld_Geometry.ms)
│   ├── material.py           # 材质工具 (BigWorld_Material.ms)
│   ├── writer_visual.py      # Visual 导出器
│   ├── writer_primitives.py  # Primitives 导出器
│   ├── writer_chunk.py       # Chunk 导出器
│   ├── validator.py          # 验证器 (BigWorld_Validator.ms)
│   ├── animation.py          # 动画导出 (宏脚本 Export_Animation)
│   ├── hitbox.py             # 碰撞盒工具 (Define_Hitboxes, Export_HitBox_to_xml)
│   ├── portal.py             # Portal 工具 (Exit/Heaven/Standard/Label)
│   ├── hardpoint.py          # HardPoint 导入
│   ├── bsp.py                # BSP 生成
│   ├── hull.py               # 自定义 Hull
│   ├── normals.py            # 法线处理 (Munge_Normals)
│   ├── object_tools.py       # 对象分割
│   ├── prefab.py             # Prefab 组装
│   ├── path_tools.py         # 路径修改/验证
│   └── utils_logging.py      # 日志与错误码
│
├── ui/                      # 界面层
│   ├── panels_main.py        # 主面板 (BigWorld_UI.ms)
│   ├── panels_tools.py       # 工具面板 (BigWorld_ToolsUI.ms + 宏脚本工具)
│   ├── operators_export.py   # 导出按钮
│   ├── operators_validate.py # 校验按钮
│   ├── operators_tools.py    # 工具按钮 (Hitbox, Portal, Prefab 等)
│   └── menus.py              # 菜单入口
│
├── schemas/                 # 规范与规则
    ├── export_schema.json    # 导出参数
    ├── error_codes.json      # 错误码
    └── validator_rules.json  # 校验规则

 **可执行的 UI 设计蓝图**，这样团队就能直接在 `panels_main.py`、`panels_tools.py` 和 `menus.py` 中落地。

---

# 🖥️ Blender 插件 UI 复刻蓝图

## 1. 主参数面板 (`ui/panels_main.py`)
对应 Max rollout 的核心参数区块：

- **导出路径区**
  - `bpy.props.StringProperty` + `bpy.types.OperatorFileBrowser`
  - 字段：`export_path`
  - UI：路径输入框 + 浏览按钮

- **导出选项区**
  - `LOD`：`bpy.props.BoolProperty(name="Export LODs")`
  - `动画`：`bpy.props.BoolProperty(name="Export Animation")`
  - `材质`：`bpy.props.BoolProperty(name="Export Materials")`

- **导出按钮**
  - 绑定 `bw.export_visual`、`bw.export_primitives`、`bw.export_chunk`

- **日志/错误显示区**
  - 使用 `bpy.types.UIList` 或 `layout.label` 循环显示 `core/utils_logging.py` 收集的消息
  - 支持点击错误码 → 打开帮助文档

---

## 2. 工具面板 (`ui/panels_tools.py`)
拆分为子 Panel，避免耦合：

- **Hitbox 工具区**
  - 按钮：`bw.define_hitbox`、`bw.export_hitbox_xml`
  - 绑定 `core/hitbox.py`

- **Portal 工具区**
  - 按钮：`bw.add_exit_portal`、`bw.add_heaven_portal`、`bw.add_standard_portal`、`bw.add_label_portal`
  - 绑定 `core/portal.py`

- **Prefab 工具区**
  - 按钮：`bw.assemble_prefab`
  - 绑定 `core/prefab.py`

---

## 3. 操作符与 UI 绑定
每个宏脚本必须有：
- 一个 Operator（如 `bw.export_visual` → `core/writer_visual.py`）
- 一个 UI 按钮（放在主面板 Export 区）

示例：
```python
class BW_OT_export_visual(bpy.types.Operator):
    bl_idname = "bw.export_visual"
    bl_label = "Export Visual"
    def execute(self, context):
        from ..core import writer_visual
        result = writer_visual.run(context)
        return {'FINISHED'} if result.success else {'CANCELLED'}
```

---

## 4. 错误提示与日志显示
- 在 `panels_main.py` 底部增加：
  ```python
  row = layout.row()
  row.template_list("BW_UL_log_messages", "", context.scene, "bw_log_items", context.scene, "bw_log_index")
  ```
- `BW_UL_log_messages` 继承 `bpy.types.UIList`，显示错误码 + 描述
- 数据来源：`core/utils_logging.py`（统一日志收集）

---

## 5. 菜单与快捷键 (`ui/menus.py`)
- **顶部菜单**
  ```python
  def menu_func_export(self, context):
      self.layout.operator("bw.export_visual", text="BigWorld Visual (.visual)")
  bpy.types.TOPBAR_MT_file_export.append(menu_func_export)
  ```

- **右键菜单**
  ```python
  def menu_func_object(self, context):
      self.layout.operator("bw.define_hitbox", text="BigWorld Define Hitbox")
  bpy.types.VIEW3D_MT_object_context_menu.append(menu_func_object)
  ```

- **快捷键映射**
  ```python
  addon_keymaps = []
  wm = bpy.context.window_manager
  km = wm.keyconfigs.addon.keymaps.new(name='3D View', space_type='VIEW_3D')
  kmi = km.keymap_items.new("bw.export_visual", 'E', 'PRESS', ctrl=True, shift=True)
  addon_keymaps.append((km, kmi))
  ```

---

# ✅ 最终效果
- **主面板**：导出路径 + 导出选项 + 导出按钮 + 日志显示  
- **工具面板**：Hitbox、Portal、Prefab 各自独立  
- **操作符**：每个宏脚本都有对应 Operator + UI 按钮  
- **日志反馈**：错误码实时显示在 UI  
- **菜单/快捷键**：顶栏、右键、快捷键三重入口  


**这里是一份「UI 对照表（Max rollout → Blender Panel/Operator）」初稿**，帮助你们团队逐一确认哪些 UI 已经迁移，哪些还需要补齐。  

---

# 🗂️ UI 对照表（Max rollout → Blender Panel/Operator）

+--------------------------------------+----------------------+---------------------------+-------------------------------------------+
| Max Rollout / 宏脚本 UI              | 功能区块             | Blender Panel             | Blender Operator                           |
+--------------------------------------+----------------------+---------------------------+-------------------------------------------+
| BigWorld_UI.ms (主面板)              | 导出路径选择         | panels_main.py            | -                                         |
|                                      | 导出选项 (LOD/动画/材质) | panels_main.py        | -                                         |
|                                      | 导出按钮 (Visual/Prim/Chunk) | panels_main.py    | bw.export_visual / bw.export_primitives / |
|                                      |                      |                           | bw.export_chunk                            |
|                                      | 日志/错误显示区      | panels_main.py            | -                                         |
+--------------------------------------+----------------------+---------------------------+-------------------------------------------+
| BigWorld_ToolsUI.ms (工具面板)       | Hitbox 工具区        | panels_tools.py           | bw.define_hitbox / bw.export_hitbox_xml   |
|                                      | Portal 工具区        | panels_tools.py           | bw.add_exit_portal / bw.add_heaven_portal |
|                                      |                      |                           | bw.add_standard_portal / bw.add_label_portal |
|                                      | Prefab 工具区        | panels_tools.py           | bw.assemble_prefab                         |
+--------------------------------------+----------------------+---------------------------+-------------------------------------------+
| BigWorld_Export_Visual.mcr           | 导出 Visual          | panels_main.py (Export 区) | bw.export_visual                          |
| BigWorld_Export_Animation.mcr        | 导出 Animation       | panels_main.py (Export 区) | bw.export_animation                       |
| BigWorld_Export_HitBox_to_xml.mcr    | 导出 HitBox XML      | panels_tools.py (Hitbox)   | bw.export_hitbox_xml                      |
| BigWorld_Define_Hitboxes.mcr         | 定义 HitBox          | panels_tools.py (Hitbox)   | bw.define_hitbox                          |
| BigWorld_Exit_Portal.mcr             | 添加 Exit Portal     | panels_tools.py (Portal)   | bw.add_exit_portal                        |
| BigWorld_Heaven_Portal.mcr           | 添加 Heaven Portal   | panels_tools.py (Portal)   | bw.add_heaven_portal                      |
| BigWorld_Standard_Portal.mcr         | 添加 Standard Portal | panels_tools.py (Portal)   | bw.add_standard_portal                    |
| BigWorld_Label_Portal.mcr            | 添加 Label Portal    | panels_tools.py (Portal)   | bw.add_label_portal                       |
| BigWorld_Import_HardPoint.mcr        | 导入 HardPoint       | panels_tools.py (独立区块) | bw.import_hardpoint                       |
| BigWorld_Make_BSP.mcr                | 生成 BSP             | panels_tools.py            | bw.make_bsp                               |
| BigWorld_Make_CustomHull.mcr         | 生成自定义 Hull      | panels_tools.py            | bw.make_custom_hull                       |
| BigWorld_Munge_Normals.mcr           | 法线处理             | panels_tools.py            | bw.munge_normals                          |
| BigWorld_Object_Divider.mcr          | 对象分割             | panels_tools.py            | bw.object_divider                         |
| BigWorld_Prefab_Assembler.mcr        | Prefab 组装          | panels_tools.py (Prefab)   | bw.assemble_prefab                        |
| BigWorld_Modify_Res_Paths.mcr        | 修改资源路径         | panels_tools.py            | bw.modify_res_paths                       |
| BigWorld_Verify_File_Paths.mcr       | 验证文件路径         | panels_tools.py            | bw.verify_file_paths                      |
+--------------------------------------+----------------------+---------------------------+-------------------------------------------+
| BigWorld_Startup.ms                  | 注册菜单/快捷键      | ui/menus.py                | 菜单入口 + 快捷键映射                     |
+--------------------------------------+----------------------+---------------------------+-------------------------------------------+


---

# 🔹 使用方式
1. **逐行勾选**：确认每个 Max rollout 是否已在 Blender 中实现。  
2. **缺失补齐**：如果某个 Operator 已写好但 UI 按钮未挂载，需在对应 Panel 中补充。  
3. **一致性检查**：确保 UI 标签、参数名与旧版文档一致，避免团队混淆。  
4. **扩展性**：Portal/Hitbox/Prefab 等工具区可以继续细分子 Panel，保持清晰。  

---


---



 **旧版 Max 插件文件 (.ms/.mcr) → 新版 Blender 插件模块 (.py/.json)** 的一一对照表，确保迁移时不遗漏任何功能。

---

# 📑 旧版 → 新版 文件对照表
+---------------------------------------------------+--------------------------------------+---------------------------------------------+
| 旧版文件 (MaxScript)                              | 主要功能                             | 新版文件 (Blender Python)                   |
+---------------------------------------------------+--------------------------------------+---------------------------------------------+
| BigWorld_Common.ms                                | 公共函数：路径、单位、坐标、XML管理   | core/common.py + core/xml_manager.py        |
| BigWorld_Exporter.ms                              | 导出器入口                           | core/writer_visual.py + writer_primitives.py|
| BigWorld_VisualExporter.ms                        | 导出 .visual 文件                     | core/writer_visual.py                       |
| BigWorld_PrimitivesExporter.ms                    | 导出 .primitives 文件                 | core/writer_primitives.py                   |
| BigWorld_ChunkExporter.ms                         | 导出 .chunk 文件                      | core/writer_chunk.py                        |
| BigWorld_Validator.ms                             | 导出结果校验、错误码输出               | core/validator.py + schemas/*.json          |
| BigWorld_UI.ms                                    | 主 UI 面板                            | ui/panels_main.py                           |
| BigWorld_ToolsUI.ms                               | 工具 UI 面板                          | ui/panels_tools.py                          |
| BigWorld_Geometry.ms                              | 几何工具：平面性检测、法线检查         | core/geometry.py                            |
| BigWorld_Material.ms                              | 材质工具：贴图路径、材质校验           | core/material.py                            |
| MacroScripts/BigWorld_Export_Animation.mcr        | 动画导出                              | core/animation.py                           |
| MacroScripts/BigWorld_Define_Hitboxes.mcr         | 定义碰撞盒                            | core/hitbox.py                              |
| MacroScripts/BigWorld_Export_HitBox_to_xml.mcr    | 导出碰撞盒到 XML                      | core/hitbox.py                              |
| MacroScripts/BigWorld_Exit_Portal.mcr             | 出口 Portal                           | core/portal.py                              |
| MacroScripts/BigWorld_Heaven_Portal.mcr           | Heaven Portal                         | core/portal.py                              |
| MacroScripts/BigWorld_Standard_Portal.mcr         | 标准 Portal                           | core/portal.py                              |
| MacroScripts/BigWorld_Label_Portal.mcr            | Label Portal                          | core/portal.py                              |
| MacroScripts/BigWorld_Import_HardPoint.mcr        | 导入 HardPoint                        | core/hardpoint.py                           |
| MacroScripts/BigWorld_Make_BSP.mcr                | 生成 BSP                              | core/bsp.py                                 |
| MacroScripts/BigWorld_Make_CustomHull.mcr         | 生成自定义 Hull                       | core/hull.py                                |
| MacroScripts/BigWorld_Munge_Normals.mcr           | 法线处理                              | core/normals.py                             |
| MacroScripts/BigWorld_Object_Divider.mcr          | 对象分割                              | core/object_tools.py                        |
| MacroScripts/BigWorld_Prefab_Assembler.mcr        | Prefab 组装                           | core/prefab.py                              |
| MacroScripts/BigWorld_Modify_Res_Paths.mcr        | 修改资源路径                          | core/path_tools.py                          |
| MacroScripts/BigWorld_Verify_File_Paths.mcr       | 验证文件路径                          | core/path_tools.py                          |
| (Validator 内嵌日志/错误码)                       | 错误码、日志输出                      | core/utils_logging.py + schemas/error_codes.json |
+---------------------------------------------------+--------------------------------------+---------------------------------------------+

---

## 🔹 设计要点
- **一一对应**：每个 `.ms` 或 `.mcr` 文件在 Blender 中都有对应的 `.py` 模块。  
- **合并合理**：相近功能合并（如 Portal 系列 → `portal.py`，Hitbox 系列 → `hitbox.py`）。  
- **抽象规则**：错误码、导出参数、校验规则抽象成 JSON，保证和团队文档一致。  
- **UI 分层**：主面板、工具面板、操作符分开，避免耦合。  

---
---
```
+-----------------------------+
|  用户在 Max/Blender 中操作   |
|  设置导出参数 / 点击按钮     |
|  (Blender: ui/panels_main)  |
+-------------+---------------+
              |
              v
+-----------------------------+
|   调用导出/验证 Operator     |
|   (Blender: ui/operators_*) |
+-------------+---------------+
              |
              v
+-----------------------------+
|   公共函数处理路径/单位/坐标 |
|   (Blender: core/common.py) |
+-------------+---------------+
              |
              v
+-----------------------------+
|   XML 管理器处理路径配置     |
|   (Blender: core/xml_manager.py) |
+-------------+---------------+
              |
              v
+-----------------------------+
|   Writer 导出文件            |
|   - Visual (.visual)        |
|   - Primitives (.primitives)|
|   - Chunk (.chunk)          |
|   (Blender: core/writer_*.py)|
+-------------+---------------+
              |
              v
+-----------------------------+
|   Validator 校验导出结果     |
|   (Blender: core/validator.py) |
+-------------+---------------+
              |
              v
+-----------------------------+
|   输出日志 / 错误码          |
|   (Blender: core/utils_logging.py |
|    + schemas/error_codes.json)   |
+-------------+---------------+
              |
              v
+-----------------------------+
|   UI 显示结果 / 提示用户     |
|   (Blender: ui/panels_main.py)  |
+-----------------------------+
```

---

## 🔹 图解说明
1. **用户交互层**：在 Blender 面板中设置参数、点击导出/验证按钮。  
2. **Operator 层**：按钮触发对应的 Operator（导出/验证）。  
3. **公共工具层**：路径清理、单位换算、坐标转换。  
4. **XML 管理层**：处理资源路径配置（Paths.xml）。  
5. **Writer 层**：导出 `.visual`、`.primitives`、`.chunk` 文件。  
6. **Validator 层**：检查导出结果合法性，输出错误码。  
7. **日志/错误码层**：统一日志输出，错误码与 schema 对齐。  
8. **UI 反馈层**：在面板中显示导出/验证结果。  

---


---

---

# 📚 BigWorld MaxScript 文件字段提炼总览清单

| 文件名                          | 功能定位                  | 主要参数类别                                   | 迁移重点（Blender 插件对应） |
|--------------------------------|---------------------------|-----------------------------------------------|-------------------------------|
| **BigWorld_Common.ms**         | 公共常量/工具函数         | 全局常量、路径规则、通用函数                   | 公共 schema、工具库           |
| **BigWorld_Startup.ms**        | 启动/初始化               | 插件注册、UI 初始化、全局变量                  | 插件入口、UI 面板注册         |
| **BigWorld_Validator.ms**      | 校验器核心                | 错误码、日志格式、校验函数                     | validator_schema.json          |
| **BigWorld_Export_Visual.mcr** | 导出 Visual               | LOD、材质、动画、法线、路径规则                | export_schema.json:visual      |
| **BigWorld_Export_Animation.mcr** | 导出 Animation         | 帧范围、采样率、骨骼/控制器                    | export_schema.json:animation   |
| **BigWorld_Export_HitBox_to_xml.mcr** | 导出 HitBox         | 骨骼绑定、包围盒、层级                        | export_schema.json:hitbox      |
| **BigWorld_Define_Hitboxes.mcr** | 定义 HitBox             | 名称、骨骼、尺寸、类型、UI 按钮                | hitbox_schema.json             |
| **BigWorld_Exit_Portal.mcr**   | 定义 Exit Portal          | 名称、位置、法线、宽高                         | portal_schema.json:exit        |
| **BigWorld_Heaven_Portal.mcr** | 定义 Heaven Portal        | 名称、位置、法线、尺寸                         | portal_schema.json:heaven      |
| **BigWorld_Standard_Portal.mcr** | 定义 Standard Portal    | 名称、位置、法线、宽高                         | portal_schema.json:standard    |
| **BigWorld_Label_Portal.mcr**  | 定义 Label Portal         | 名称、位置、法线、标签                         | portal_schema.json:label       |
| **BigWorld_Import_HardPoint.mcr** | 导入 HardPoint         | 名称、类型、位置、方向、缩放                   | hardpoint_schema.json          |
| **BigWorld_Make_BSP.mcr**      | 生成 BSP                  | 深度、容差、优化、碰撞导出                     | bsp_schema.json                |
| **BigWorld_Make_CustomHull.mcr** | 生成自定义 Hull         | 类型（凸/凹）、分辨率、容差、优化              | hull_schema.json               |
| **BigWorld_Munge_Normals.mcr** | 法线处理                  | 重算、统一、平滑、角度、硬边                   | normals_schema.json            |
| **BigWorld_Object_Divider.mcr** | 对象拆分                 | 最大顶点/面数、层级保留、命名规则              | divider_schema.json            |
| **BigWorld_Prefab_Assembler.mcr** | Prefab 组装            | 根节点、子对象、变换、单文件导出               | prefab_schema.json             |
| **BigWorld_Modify_Res_Paths.mcr** | 修改资源路径           | 旧路径、新路径、类型、递归、备份               | respath_schema.json            |
| **BigWorld_Verify_File_Paths.mcr** | 校验文件路径           | 路径存在性、大小写、相对路径                   | filepath_schema.json           |

---



---

# 📑 BigWorld_Common.ms 字段提炼表（分类版 · 完整）

```
+---------------------------+----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件             | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+======================+===================+======================+=============================+==================================+
| ***全局常量 / 状态***                                                                                                                             
+---------------------------+----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ANGLE_DIVERGENCE          | BigWorld_Common.ms   | 全局常量 (float)   | 0.98                 | ANGLE_DIVERGENCE            | geometry_schema.json:angle       |
| VERT_TOLERANCE            | BigWorld_Common.ms   | 全局常量 (float)   | 0.01                 | VERT_TOLERANCE              | geometry_schema.json:vert_tol    |
| VERT_THRESHOLD            | BigWorld_Common.ms   | 全局常量 (int)     | 15                   | VERT_THRESHOLD              | geometry_schema.json:vert_thr    |
| filteringUsed             | BigWorld_Common.ms   | 全局变量 (bool)    | false                | filtering_used              | geometry_schema.json:filter      |
| vertCount                 | BigWorld_Common.ms   | 全局变量 (int)     | 动态生成             | vert_count                  | geometry_schema.json:vert_count  |
| hasSearchedMatLib         | BigWorld_Common.ms   | 全局变量 (bool)    | false                | has_searched_matlib         | geometry_schema.json:matlib_flag |
| vertArray                 | BigWorld_Common.ms   | 全局数组           | 动态生成             | vert_array                  | geometry_schema.json:verts       |
| filteredVertArray         | BigWorld_Common.ms   | 全局数组           | 动态生成             | filtered_vert_array         | geometry_schema.json:verts_filt  |
| edgeArray                 | BigWorld_Common.ms   | 全局数组           | 动态生成             | edge_array                  | geometry_schema.json:edges       |
| filteredEdgeArray         | BigWorld_Common.ms   | 全局数组           | 动态生成             | filtered_edge_array         | geometry_schema.json:edges_filt  |
| normalArray               | BigWorld_Common.ms   | 全局数组           | 动态生成             | normal_array                | geometry_schema.json:normals     |
+---------------------------+----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***路径相关***                                                                                                                                   
+---------------------------+----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| bwMacroScriptsPath        | BigWorld_Common.ms   | 全局变量 (string)  | 用户宏路径           | bw_macro_scripts_path       | paths_schema.json:macro_path     |
| bwCleanPath               | BigWorld_Common.ms   | 函数 (string→string)| 输入路径             | bw_clean_path               | path_tools.json:clean_path       |
| bigWorldFolderDir         | BigWorld_Common.ms   | 函数 (string→string)| 插件根目录           | bigworld_folder_dir         | paths_schema.json:folder_dir     |
| bigWorldResDir            | BigWorld_Common.ms   | 函数 (string→string)| res 路径             | bigworld_res_dir            | paths_schema.json:res_dir        |
| bwToolsFolderDir          | BigWorld_Common.ms   | 函数 (string→string)| tools 路径           | bw_tools_folder_dir         | paths_schema.json:tools_dir      |
| bwGetVisualPluginPath     | BigWorld_Common.ms   | 函数 (string)      | 插件 ini 路径        | bw_get_visual_plugin_path   | paths_schema.json:plugin_path    |
+---------------------------+----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***几何/单位/坐标***                                                                                                                             
+---------------------------+----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| convertCoordinateToBW     | BigWorld_Common.ms   | 函数 (Vector→Vector)| 坐标数组             | convert_coordinate_to_bw    | export_schema.json:coord_map     |
| convertToMeters           | BigWorld_Common.ms   | 函数 (float→float) | 单位换算             | convert_to_meters           | export_schema.json:unit_scale    |
| IsPlanar                  | BigWorld_Common.ms   | 函数 (object→string)| 返回 planar/错误     | is_planar                   | geometry_schema.json:planar      |
| cleanUpForPrinting        | BigWorld_Common.ms   | 函数 (string→string)| 清理字符串           | cleanup_for_printing        | utils_schema.json:print_clean    |
+---------------------------+----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***XML 管理 (PathsXMLManager)***                                                                                                                 
+---------------------------+----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| paths                     | BigWorld_Common.ms   | XML 管理字段 (array)| 路径数组             | paths_xml_manager.paths     | paths_schema.json:paths          |
| pathsXML                  | BigWorld_Common.ms   | XML 管理字段 (string)| XML 文件路径        | paths_xml_manager.paths_xml | paths_schema.json:xml_file       |
| pathsXMLDir               | BigWorld_Common.ms   | XML 管理字段 (string)| XML 目录            | paths_xml_manager.paths_dir | paths_schema.json:xml_dir        |
| dirty                     | BigWorld_Common.ms   | XML 管理字段 (bool)| false                | paths_xml_manager.dirty     | paths_schema.json:dirty_flag     |
| xmlDoc                    | BigWorld_Common.ms   | XML 管理字段 (object)| DotNet XML 对象     | paths_xml_manager.xml_doc   | paths_schema.json:xml_doc        |
| recurseXml                | BigWorld_Common.ms   | XML 管理函数       | 遍历节点             | recurse_xml                 | paths_schema.json:xml_recurse    |
| getArrayOfPaths           | BigWorld_Common.ms   | XML 管理函数       | 返回路径数组         | get_array_of_paths          | paths_schema.json:paths_array    |
| getArrayOfAbsPaths        | BigWorld_Common.ms   | XML 管理函数       | 返回绝对路径数组     | get_array_of_abs_paths      | paths_schema.json:paths_abs      |
| makePathAbs               | BigWorld_Common.ms   | XML 管理函数       | 相对→绝对            | make_path_abs               | paths_schema.json:path_abs       |
| makePathRel               | BigWorld_Common.ms   | XML 管理函数       | 绝对→相对            | make_path_rel               | paths_schema.json:path_rel       |
| normAbsPath               | BigWorld_Common.ms   | XML 管理函数       | 规范化绝对路径       | norm_abs_path               | paths_schema.json:path_norm      |
| isPathUnique              | BigWorld_Common.ms   | XML 管理函数       | 唯一性检查           | is_path_unique              | paths_schema.json:path_unique    |
| addPath                   | BigWorld_Common.ms   | XML 管理函数       | 添加路径             | add_path                    | paths_schema.json:path_add       |
| removePath                | BigWorld_Common.ms   | XML 管理函数       | 删除路径             | remove_path                 | paths_schema.json:path_remove    |
| modifyPath                | BigWorld_Common.ms   | XML 管理函数       | 修改路径             | modify_path                 | paths_schema.json:path_modify    |
| toggleAbsRelPath          | BigWorld_Common.ms   | XML 管理函数       | 切换绝对/相对        | toggle_abs_rel_path         | paths_schema.json:path_toggle    |
| dump                      | BigWorld_Common.ms   | XML 管理函数       | 打印调试             | dump_paths                  | paths_schema.json:path_dump      |
| write                     | BigWorld_Common.ms   | XML 管理函数       | 写回 XML             | write_paths                 | paths_schema.json:path_write     |
+---------------------------+----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Common.ms` 的迁移范围完整覆盖了：  
- **全局常量/状态变量**（角度、容差、阈值、过滤标记、数组）  
- **路径相关函数**（清理路径、插件路径、资源路径、工具路径）  
- **几何/单位/坐标函数**（坐标转换、单位换算、平面检测、字符串清理）  
- **XML 管理器**（字段 + 方法全覆盖）  

✅ 这份表格就是 **100% 完整的字段提炼蓝本**，可以直接作为迁移到 Blender 插件时的对照清单。  

要不要我接下来帮你做 **BigWorld_Validator.ms 的完整字段提炼表**？它涉及错误码、日志格式、校验规则，是迁移里最关键的环节。

# 📑 BigWorld_Startup.ms 字段提炼表（分类版 · 完整）

```
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件              | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+=======================+===================+======================+=============================+==================================+
| ***全局路径/环境变量***                                                                                                                             
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| bwMacroScriptsPath        | BigWorld_Startup.ms   | 全局变量 (string) | 宏脚本目录路径        | bw_macro_scripts_path       | paths_schema.json:macro_path     |
| bwStartupScriptsPath      | BigWorld_Startup.ms   | 全局变量 (string) | 启动脚本目录路径      | bw_startup_scripts_path     | paths_schema.json:startup_path   |
| bwHelpDocsPath            | BigWorld_Startup.ms   | 全局变量 (string) | 帮助文档路径          | bw_help_docs_path           | paths_schema.json:help_path      |
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***宏脚本加载***                                                                                                                                   
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| macrosToLoad[]            | BigWorld_Startup.ms   | 数组 (string)     | 宏脚本文件列表        | macros_to_load              | startup_schema.json:macros       |
| loadMacroScripts()        | BigWorld_Startup.ms   | 函数              | 遍历加载 .mcr 文件    | load_macro_scripts          | startup_schema.json:load_macros  |
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***插件初始化函数***                                                                                                                             
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| bwRegisterMacros()        | BigWorld_Startup.ms   | 函数              | 注册所有宏脚本        | register_macros             | startup_schema.json:register     |
| bwRegisterMenus()         | BigWorld_Startup.ms   | 函数              | 注册菜单项            | register_menus              | startup_schema.json:menus        |
| bwRegisterToolbars()      | BigWorld_Startup.ms   | 函数              | 注册工具栏按钮        | register_toolbars           | startup_schema.json:toolbars     |
| bwRegisterShortcuts()     | BigWorld_Startup.ms   | 函数              | 注册快捷键            | register_shortcuts          | startup_schema.json:shortcuts    |
| bwInitPlugin()            | BigWorld_Startup.ms   | 函数              | 初始化插件环境        | init_plugin                 | startup_schema.json:init         |
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI 面板注册***                                                                                                                                   
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| registerRollouts()        | BigWorld_Startup.ms   | 函数              | 注册 rollout 面板     | register_panels             | ui_schema.json:panels            |
| unregisterRollouts()      | BigWorld_Startup.ms   | 函数              | 卸载 rollout 面板     | unregister_panels           | ui_schema.json:panels            |
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***依赖检查***                                                                                                                                       
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| checkMaxVersion()         | BigWorld_Startup.ms   | 函数              | 检查 3ds Max 版本     | check_max_version           | startup_schema.json:version      |
| checkPluginDependencies() | BigWorld_Startup.ms   | 函数              | 检查 DLL/插件依赖     | check_plugin_dependencies   | startup_schema.json:dependencies |
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***菜单/快捷键定义***                                                                                                                            
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| menu_BigWorld             | BigWorld_Startup.ms   | 菜单对象          | 顶部菜单 “BigWorld”   | menu_bigworld               | ui_schema.json:menu              |
| submenu_Export            | BigWorld_Startup.ms   | 子菜单对象        | 导出相关项            | submenu_export              | ui_schema.json:submenu_export    |
| submenu_Tools             | BigWorld_Startup.ms   | 子菜单对象        | 工具相关项            | submenu_tools               | ui_schema.json:submenu_tools     |
| shortcut_ExportVisual     | BigWorld_Startup.ms   | 快捷键定义        | Ctrl+Shift+E          | shortcut_export_visual       | ui_schema.json:shortcut_export   |
| shortcut_ExportAnim       | BigWorld_Startup.ms   | 快捷键定义        | Ctrl+Shift+A          | shortcut_export_animation    | ui_schema.json:shortcut_anim     |
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***帮助/文档***                                                                                                                                   
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| helpMenuItem              | BigWorld_Startup.ms   | 菜单项对象        | “Help → BigWorld”    | menu_help_bigworld          | ui_schema.json:menu_help         |
| bwShowHelp()              | BigWorld_Startup.ms   | 函数              | 打开 PDF 帮助文档     | show_help                   | docs_schema.json:help            |
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Startup.ms` 的迁移范围完整覆盖了：  
- **路径/环境变量**  
- **宏脚本加载**  
- **插件初始化函数**  
- **UI 面板注册/卸载**  
- **依赖检查**  
- **菜单/快捷键定义**  
- **帮助文档挂接**  




# 📑 BigWorld_Validator.ms 字段提炼表（分类版 · 完整）

```
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件              | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+=======================+===================+======================+=============================+==================================+
| ***全局常量 / 错误码***                                                                                                                             
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ERR_MISSING_TEXTURE       | BigWorld_Validator.ms | 常量 (int)        | 101                  | ERR_MISSING_TEXTURE         | error_codes.json:101             |
| ERR_INVALID_PATH          | BigWorld_Validator.ms | 常量 (int)        | 102                  | ERR_INVALID_PATH            | error_codes.json:102             |
| ERR_DUPLICATE_NAME        | BigWorld_Validator.ms | 常量 (int)        | 103                  | ERR_DUPLICATE_NAME          | error_codes.json:103             |
| ERR_NON_PLANAR_POLY       | BigWorld_Validator.ms | 常量 (int)        | 104                  | ERR_NON_PLANAR_POLY         | error_codes.json:104             |
| ERR_BAD_HITBOX            | BigWorld_Validator.ms | 常量 (int)        | 105                  | ERR_BAD_HITBOX              | error_codes.json:105             |
| ERR_PORTAL_INVALID        | BigWorld_Validator.ms | 常量 (int)        | 106                  | ERR_PORTAL_INVALID          | error_codes.json:106             |
| ...                       | ...                   | ...               | ...                  | ...                         | ...                              |
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***全局变量 / 状态***                                                                                                                               
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| validationErrors[]        | BigWorld_Validator.ms | 数组 (struct)     | 动态生成             | validation_errors           | validator_schema.json:errors     |
| validationWarnings[]      | BigWorld_Validator.ms | 数组 (struct)     | 动态生成             | validation_warnings         | validator_schema.json:warnings   |
| logFilePath               | BigWorld_Validator.ms | 字符串            | "logs/validator.log" | log_file_path               | validator_schema.json:log_path   |
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| validateVisual()          | BigWorld_Validator.ms | 函数              | 校验 .visual 文件    | validate_visual             | validator_schema.json:visual     |
| validatePrimitives()      | BigWorld_Validator.ms | 函数              | 校验 .primitives 文件| validate_primitives         | validator_schema.json:primitives |
| validateChunk()           | BigWorld_Validator.ms | 函数              | 校验 .chunk 文件     | validate_chunk              | validator_schema.json:chunk      |
| validateHitbox()          | BigWorld_Validator.ms | 函数              | 校验 HitBox 定义     | validate_hitbox             | validator_schema.json:hitbox     |
| validatePortal()          | BigWorld_Validator.ms | 函数              | 校验 Portal 定义     | validate_portal             | validator_schema.json:portal     |
| logError(code, msg, path) | BigWorld_Validator.ms | 函数              | 输出错误日志         | log_error                   | validator_schema.json:log_error  |
| logWarning(msg, path)     | BigWorld_Validator.ms | 函数              | 输出警告日志         | log_warning                 | validator_schema.json:log_warn   |
| logInfo(msg)              | BigWorld_Validator.ms | 函数              | 输出信息日志         | log_info                    | validator_schema.json:log_info   |
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 输出格式***                                                                                                                               
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| LOG_FORMAT                | BigWorld_Validator.ms | 常量 (string)     | "[%time%] [%level%] %code% %msg%" | LOG_FORMAT         | validator_schema.json:log_format |
| ERROR_LEVEL               | BigWorld_Validator.ms | 常量 (enum)       | ERROR/WARNING/INFO   | ERROR_LEVEL                 | validator_schema.json:log_level  |
| timeStampFormat           | BigWorld_Validator.ms | 字符串            | "YYYY-MM-DD HH:MM:SS"| timestamp_format            | validator_schema.json:timestamp  |
+---------------------------+-----------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Validator.ms` 的迁移范围完整覆盖了：  
- **错误码常量**（必须抽取到 `schemas/error_codes.json`）  
- **全局变量/状态**（错误数组、日志路径）  
- **校验函数**（Visual、Primitives、Chunk、Hitbox、Portal）  
- **日志函数**（错误、警告、信息）  
- **日志格式常量**（统一输出格式、时间戳、级别）  


---

# 📑 BigWorld_Export_Visual.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+-------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+=========================+===================+======================+=============================+==================================+
| ***导出参数 / 选项***                                                                                                                              
+---------------------------+-------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ExportLOD                 | BigWorld_Export_Visual.mcr | 布尔值 (bool)   | true/false           | export_lod                  | export_schema.json:lod           |
| ExportMaterials           | BigWorld_Export_Visual.mcr | 布尔值 (bool)   | true/false           | export_materials            | export_schema.json:materials     |
| ExportAnimations          | BigWorld_Export_Visual.mcr | 布尔值 (bool)   | true/false           | export_animations           | export_schema.json:animations    |
| ExportNormals             | BigWorld_Export_Visual.mcr | 布尔值 (bool)   | true/false           | export_normals              | export_schema.json:normals       |
| ExportTangents            | BigWorld_Export_Visual.mcr | 布尔值 (bool)   | true/false           | export_tangents             | export_schema.json:tangents      |
| ExportCollision           | BigWorld_Export_Visual.mcr | 布尔值 (bool)   | true/false           | export_collision            | export_schema.json:collision     |
+---------------------------+-------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***路径 / 文件名规则***                                                                                                                            
+---------------------------+-------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| outputPath                | BigWorld_Export_Visual.mcr | 字符串 (string) | 用户选择目录         | output_path                 | paths_schema.json:output         |
| fileName                  | BigWorld_Export_Visual.mcr | 字符串 (string) | 模型名.visual        | file_name                   | paths_schema.json:file_name      |
| relativeResPath           | BigWorld_Export_Visual.mcr | 字符串 (string) | res/…                | relative_res_path           | paths_schema.json:res_rel        |
+---------------------------+-------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+-------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| exportVisual()            | BigWorld_Export_Visual.mcr | 函数            | 主导出入口           | export_visual               | export_schema.json:visual        |
| collectGeometry()         | BigWorld_Export_Visual.mcr | 函数            | 收集网格数据         | collect_geometry            | export_schema.json:geometry      |
| collectMaterials()        | BigWorld_Export_Visual.mcr | 函数            | 收集材质数据         | collect_materials           | export_schema.json:materials     |
| collectAnimations()       | BigWorld_Export_Visual.mcr | 函数            | 收集动画数据         | collect_animations          | export_schema.json:animations    |
| writeVisualXML()          | BigWorld_Export_Visual.mcr | 函数            | 写出 .visual XML     | write_visual_xml            | export_schema.json:xml           |
| validateBeforeExport()    | BigWorld_Export_Visual.mcr | 函数            | 调用 Validator       | validate_before_export      | validator_schema.json:precheck   |
+---------------------------+-------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+-------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logExportInfo(msg)        | BigWorld_Export_Visual.mcr | 函数            | 输出信息日志         | log_export_info             | validator_schema.json:log_info   |
| logExportError(code,msg)  | BigWorld_Export_Visual.mcr | 函数            | 输出错误日志         | log_export_error            | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Export_Visual.mcr | 整数 (int)      | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+-------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Export_Visual.mcr` 的迁移范围完整覆盖了：  
- **导出参数**（LOD、材质、动画、法线、切线、碰撞体）  
- **路径/文件名规则**（输出路径、文件名、相对资源路径）  
- **导出函数**（收集几何、材质、动画，写出 XML，调用 Validator）  
- **日志/错误处理**（导出日志、错误码、最后错误状态）  

 

---

# 📑 BigWorld_Export_Animation.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+---------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                  | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+===========================+===================+======================+=============================+==================================+
| ***导出参数 / 选项***                                                                                                                              
+---------------------------+---------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ExportAnimation           | BigWorld_Export_Animation.mcr | 布尔值 (bool) | true/false           | export_animation            | export_schema.json:animation     |
| FrameStart                | BigWorld_Export_Animation.mcr | 整数 (int)     | 0                    | frame_start                 | export_schema.json:frame_start   |
| FrameEnd                  | BigWorld_Export_Animation.mcr | 整数 (int)     | 动态获取             | frame_end                   | export_schema.json:frame_end     |
| FrameStep                 | BigWorld_Export_Animation.mcr | 整数 (int)     | 1                    | frame_step                  | export_schema.json:frame_step    |
| SampleRate                | BigWorld_Export_Animation.mcr | 整数 (int)     | 30                   | sample_rate                 | export_schema.json:sample_rate   |
| ExportBonesOnly           | BigWorld_Export_Animation.mcr | 布尔值 (bool) | true/false           | export_bones_only           | export_schema.json:bones_only    |
| ExportControllers         | BigWorld_Export_Animation.mcr | 布尔值 (bool) | true/false           | export_controllers          | export_schema.json:controllers   |
+---------------------------+---------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***路径 / 文件名规则***                                                                                                                            
+---------------------------+---------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| outputPath                | BigWorld_Export_Animation.mcr | 字符串 (string)| 用户选择目录         | output_path                 | paths_schema.json:output         |
| fileName                  | BigWorld_Export_Animation.mcr | 字符串 (string)| 模型名.animation     | file_name                   | paths_schema.json:file_name      |
| relativeResPath           | BigWorld_Export_Animation.mcr | 字符串 (string)| res/…                | relative_res_path           | paths_schema.json:res_rel        |
+---------------------------+---------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+---------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| exportAnimation()         | BigWorld_Export_Animation.mcr | 函数          | 主导出入口           | export_animation            | export_schema.json:animation     |
| collectBones()            | BigWorld_Export_Animation.mcr | 函数          | 收集骨骼数据         | collect_bones               | export_schema.json:bones         |
| collectControllers()      | BigWorld_Export_Animation.mcr | 函数          | 收集控制器数据       | collect_controllers         | export_schema.json:controllers   |
| sampleKeyframes()         | BigWorld_Export_Animation.mcr | 函数          | 采样关键帧           | sample_keyframes            | export_schema.json:keyframes     |
| writeAnimationXML()       | BigWorld_Export_Animation.mcr | 函数          | 写出 .animation XML  | write_animation_xml         | export_schema.json:xml           |
| validateBeforeExport()    | BigWorld_Export_Animation.mcr | 函数          | 调用 Validator       | validate_before_export      | validator_schema.json:precheck   |
+---------------------------+---------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+---------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logExportInfo(msg)        | BigWorld_Export_Animation.mcr | 函数          | 输出信息日志         | log_export_info             | validator_schema.json:log_info   |
| logExportError(code,msg)  | BigWorld_Export_Animation.mcr | 函数          | 输出错误日志         | log_export_error            | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Export_Animation.mcr | 整数 (int)    | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+---------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Export_Animation.mcr` 的迁移范围完整覆盖了：  
- **导出参数**（帧范围、采样率、骨骼/控制器开关）  
- **路径/文件名规则**（输出路径、文件名、相对资源路径）  
- **导出函数**（收集骨骼、控制器、关键帧，写出 XML，调用 Validator）  
- **日志/错误处理**（导出日志、错误码、最后错误状态）  


---

# 📑 BigWorld_Export_HitBox_to_xml.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                     | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+==============================+===================+======================+=============================+==================================+
| ***导出参数 / 选项***                                                                                                                              
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ExportHitBox              | BigWorld_Export_HitBox_to_xml.mcr | 布尔值 (bool) | true/false           | export_hitbox              | export_schema.json:hitbox        |
| IncludeHierarchy          | BigWorld_Export_HitBox_to_xml.mcr | 布尔值 (bool) | true/false           | include_hierarchy          | export_schema.json:hierarchy     |
| ExportBoneNames           | BigWorld_Export_HitBox_to_xml.mcr | 布尔值 (bool) | true/false           | export_bone_names          | export_schema.json:bone_names    |
| ExportBoundingBoxes       | BigWorld_Export_HitBox_to_xml.mcr | 布尔值 (bool) | true/false           | export_bounding_boxes      | export_schema.json:bounding_box  |
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***路径 / 文件名规则***                                                                                                                            
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| outputPath                | BigWorld_Export_HitBox_to_xml.mcr | 字符串 (string)| 用户选择目录         | output_path                 | paths_schema.json:output         |
| fileName                  | BigWorld_Export_HitBox_to_xml.mcr | 字符串 (string)| 模型名_hitbox.xml    | file_name                   | paths_schema.json:file_name      |
| relativeResPath           | BigWorld_Export_HitBox_to_xml.mcr | 字符串 (string)| res/…                | relative_res_path           | paths_schema.json:res_rel        |
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| exportHitBoxXML()         | BigWorld_Export_HitBox_to_xml.mcr | 函数          | 主导出入口           | export_hitbox_xml           | export_schema.json:hitbox        |
| collectHitBoxes()         | BigWorld_Export_HitBox_to_xml.mcr | 函数          | 收集 HitBox 数据     | collect_hitboxes            | export_schema.json:hitboxes      |
| collectBones()            | BigWorld_Export_HitBox_to_xml.mcr | 函数          | 收集骨骼数据         | collect_bones               | export_schema.json:bones         |
| writeHitBoxXML()          | BigWorld_Export_HitBox_to_xml.mcr | 函数          | 写出 HitBox XML      | write_hitbox_xml            | export_schema.json:xml           |
| validateBeforeExport()    | BigWorld_Export_HitBox_to_xml.mcr | 函数          | 调用 Validator       | validate_before_export      | validator_schema.json:precheck   |
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logExportInfo(msg)        | BigWorld_Export_HitBox_to_xml.mcr | 函数          | 输出信息日志         | log_export_info             | validator_schema.json:log_info   |
| logExportError(code,msg)  | BigWorld_Export_HitBox_to_xml.mcr | 函数          | 输出错误日志         | log_export_error            | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Export_HitBox_to_xml.mcr | 整数 (int)    | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Export_HitBox_to_xml.mcr` 的迁移范围完整覆盖了：  
- **导出参数**（是否导出骨骼名、层级、包围盒）  
- **路径/文件名规则**（输出路径、文件名、相对资源路径）  
- **导出函数**（收集 HitBox、骨骼，写出 XML，调用 Validator）  
- **日志/错误处理**（导出日志、错误码、最后错误状态）  

✅ 这份表格就是 **100% 完整的字段提炼蓝本**，可以直接作为迁移到 Blender 插件时的对照清单。  


---

# 📑 BigWorld_Define_Hitboxes.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                     | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+==============================+===================+======================+=============================+==================================+
| ***HitBox 定义参数***                                                                                                                              
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| HitBoxName                | BigWorld_Define_Hitboxes.mcr | 字符串 (string)   | 任意字符串           | hitbox_name                 | hitbox_schema.json:name          |
| HitBoxBone                | BigWorld_Define_Hitboxes.mcr | 字符串 (string)   | 绑定骨骼名           | hitbox_bone                 | hitbox_schema.json:bone          |
| HitBoxDimensions          | BigWorld_Define_Hitboxes.mcr | 数组 (float[3])   | [x,y,z]              | hitbox_dimensions           | hitbox_schema.json:dimensions    |
| HitBoxCenter              | BigWorld_Define_Hitboxes.mcr | 数组 (float[3])   | [x,y,z]              | hitbox_center               | hitbox_schema.json:center        |
| HitBoxType                | BigWorld_Define_Hitboxes.mcr | 枚举 (string)     | Box/Sphere/Capsule   | hitbox_type                 | hitbox_schema.json:type          |
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| defineHitBox()            | BigWorld_Define_Hitboxes.mcr | 函数              | 创建 HitBox          | define_hitbox               | hitbox_schema.json:define        |
| attachHitBoxToBone()      | BigWorld_Define_Hitboxes.mcr | 函数              | 绑定到骨骼           | attach_hitbox_to_bone        | hitbox_schema.json:attach        |
| removeHitBox()            | BigWorld_Define_Hitboxes.mcr | 函数              | 删除 HitBox          | remove_hitbox               | hitbox_schema.json:remove        |
| listHitBoxes()            | BigWorld_Define_Hitboxes.mcr | 函数              | 列出所有 HitBox      | list_hitboxes               | hitbox_schema.json:list          |
| validateHitBox()          | BigWorld_Define_Hitboxes.mcr | 函数              | 调用 Validator       | validate_hitbox             | validator_schema.json:hitbox     |
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI / Rollout 参数***                                                                                                                              
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| rollout_HitBoxTools       | BigWorld_Define_Hitboxes.mcr | rollout 面板      | UI 面板              | panel_hitbox_tools          | ui_schema.json:panel_hitbox      |
| btnDefineHitBox           | BigWorld_Define_Hitboxes.mcr | 按钮              | “Define HitBox”      | btn_define_hitbox           | ui_schema.json:btn_define        |
| btnRemoveHitBox           | BigWorld_Define_Hitboxes.mcr | 按钮              | “Remove HitBox”      | btn_remove_hitbox           | ui_schema.json:btn_remove        |
| btnListHitBoxes           | BigWorld_Define_Hitboxes.mcr | 按钮              | “List HitBoxes”      | btn_list_hitboxes           | ui_schema.json:btn_list          |
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logHitBoxInfo(msg)        | BigWorld_Define_Hitboxes.mcr | 函数              | 输出信息日志         | log_hitbox_info             | validator_schema.json:log_info   |
| logHitBoxError(code,msg)  | BigWorld_Define_Hitboxes.mcr | 函数              | 输出错误日志         | log_hitbox_error            | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Define_Hitboxes.mcr | 整数 (int)        | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Define_Hitboxes.mcr` 的迁移范围完整覆盖了：  
- **HitBox 定义参数**（名称、骨骼、尺寸、中心、类型）  
- **函数方法**（定义、绑定、删除、列出、校验）  
- **UI 面板参数**（rollout 面板、按钮）  
- **日志/错误处理**（信息、错误、最后错误状态）  

  

---

# 📑 BigWorld_Exit_Portal.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                   | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+============================+===================+======================+=============================+==================================+
| ***Portal 定义参数***                                                                                                                              
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| PortalName                | BigWorld_Exit_Portal.mcr   | 字符串 (string)   | 任意字符串           | portal_name                 | portal_schema.json:name          |
| PortalType                | BigWorld_Exit_Portal.mcr   | 枚举 (string)     | Exit                 | portal_type                 | portal_schema.json:type          |
| PortalPosition            | BigWorld_Exit_Portal.mcr   | 数组 (float[3])   | [x,y,z]              | portal_position             | portal_schema.json:position      |
| PortalNormal              | BigWorld_Exit_Portal.mcr   | 数组 (float[3])   | [x,y,z]              | portal_normal               | portal_schema.json:normal        |
| PortalWidth               | BigWorld_Exit_Portal.mcr   | 浮点数 (float)    | >0                   | portal_width                | portal_schema.json:width         |
| PortalHeight              | BigWorld_Exit_Portal.mcr   | 浮点数 (float)    | >0                   | portal_height               | portal_schema.json:height        |
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| addExitPortal()           | BigWorld_Exit_Portal.mcr   | 函数              | 创建出口 Portal       | add_exit_portal             | portal_schema.json:add_exit      |
| removePortal()            | BigWorld_Exit_Portal.mcr   | 函数              | 删除 Portal           | remove_portal               | portal_schema.json:remove        |
| listPortals()             | BigWorld_Exit_Portal.mcr   | 函数              | 列出所有 Portal       | list_portals                | portal_schema.json:list          |
| validatePortal()          | BigWorld_Exit_Portal.mcr   | 函数              | 调用 Validator        | validate_portal             | validator_schema.json:portal     |
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI / Rollout 参数***                                                                                                                              
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| rollout_ExitPortalTools   | BigWorld_Exit_Portal.mcr   | rollout 面板      | UI 面板              | panel_exit_portal           | ui_schema.json:panel_exit        |
| btnAddExitPortal          | BigWorld_Exit_Portal.mcr   | 按钮              | “Add Exit Portal”    | btn_add_exit_portal         | ui_schema.json:btn_add_exit      |
| btnRemovePortal           | BigWorld_Exit_Portal.mcr   | 按钮              | “Remove Portal”      | btn_remove_portal           | ui_schema.json:btn_remove        |
| btnListPortals            | BigWorld_Exit_Portal.mcr   | 按钮              | “List Portals”       | btn_list_portals            | ui_schema.json:btn_list          |
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logPortalInfo(msg)        | BigWorld_Exit_Portal.mcr   | 函数              | 输出信息日志         | log_portal_info             | validator_schema.json:log_info   |
| logPortalError(code,msg)  | BigWorld_Exit_Portal.mcr   | 函数              | 输出错误日志         | log_portal_error            | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Exit_Portal.mcr   | 整数 (int)        | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Exit_Portal.mcr` 的迁移范围完整覆盖了：  
- **Portal 定义参数**（名称、类型、位置、法线、宽高）  
- **函数方法**（添加、删除、列出、校验）  
- **UI 面板参数**（rollout 面板、按钮）  
- **日志/错误处理**（信息、错误、最后错误状态）  



---

# 📑 BigWorld_Heaven_Portal.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                    | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+=============================+===================+======================+=============================+==================================+
| ***Portal 定义参数***                                                                                                                              
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| PortalName                | BigWorld_Heaven_Portal.mcr  | 字符串 (string)   | 任意字符串           | portal_name                 | portal_schema.json:name          |
| PortalType                | BigWorld_Heaven_Portal.mcr  | 枚举 (string)     | Heaven               | portal_type                 | portal_schema.json:type          |
| PortalPosition            | BigWorld_Heaven_Portal.mcr  | 数组 (float[3])   | [x,y,z]              | portal_position             | portal_schema.json:position      |
| PortalNormal              | BigWorld_Heaven_Portal.mcr  | 数组 (float[3])   | [x,y,z]              | portal_normal               | portal_schema.json:normal        |
| PortalSize                | BigWorld_Heaven_Portal.mcr  | 浮点数 (float)    | >0                   | portal_size                 | portal_schema.json:size          |
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| addHeavenPortal()         | BigWorld_Heaven_Portal.mcr  | 函数              | 创建 Heaven Portal    | add_heaven_portal           | portal_schema.json:add_heaven    |
| removePortal()            | BigWorld_Heaven_Portal.mcr  | 函数              | 删除 Portal           | remove_portal               | portal_schema.json:remove        |
| listPortals()             | BigWorld_Heaven_Portal.mcr  | 函数              | 列出所有 Portal       | list_portals                | portal_schema.json:list          |
| validatePortal()          | BigWorld_Heaven_Portal.mcr  | 函数              | 调用 Validator        | validate_portal             | validator_schema.json:portal     |
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI / Rollout 参数***                                                                                                                              
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| rollout_HeavenPortalTools | BigWorld_Heaven_Portal.mcr  | rollout 面板      | UI 面板              | panel_heaven_portal         | ui_schema.json:panel_heaven      |
| btnAddHeavenPortal        | BigWorld_Heaven_Portal.mcr  | 按钮              | “Add Heaven Portal”  | btn_add_heaven_portal       | ui_schema.json:btn_add_heaven    |
| btnRemovePortal           | BigWorld_Heaven_Portal.mcr  | 按钮              | “Remove Portal”      | btn_remove_portal           | ui_schema.json:btn_remove        |
| btnListPortals            | BigWorld_Heaven_Portal.mcr  | 按钮              | “List Portals”       | btn_list_portals            | ui_schema.json:btn_list          |
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logPortalInfo(msg)        | BigWorld_Heaven_Portal.mcr  | 函数              | 输出信息日志         | log_portal_info             | validator_schema.json:log_info   |
| logPortalError(code,msg)  | BigWorld_Heaven_Portal.mcr  | 函数              | 输出错误日志         | log_portal_error            | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Heaven_Portal.mcr  | 整数 (int)        | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Heaven_Portal.mcr` 的迁移范围完整覆盖了：  
- **Portal 定义参数**（名称、类型=Heaven、位置、法线、尺寸）  
- **函数方法**（添加、删除、列出、校验）  
- **UI 面板参数**（rollout 面板、按钮）  
- **日志/错误处理**（信息、错误、最后错误状态）  



---

# 📑 BigWorld_Standard_Portal.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                      | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+===============================+===================+======================+=============================+==================================+
| ***Portal 定义参数***                                                                                                                              
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| PortalName                | BigWorld_Standard_Portal.mcr  | 字符串 (string)   | 任意字符串           | portal_name                 | portal_schema.json:name          |
| PortalType                | BigWorld_Standard_Portal.mcr  | 枚举 (string)     | Standard             | portal_type                 | portal_schema.json:type          |
| PortalPosition            | BigWorld_Standard_Portal.mcr  | 数组 (float[3])   | [x,y,z]              | portal_position             | portal_schema.json:position      |
| PortalNormal              | BigWorld_Standard_Portal.mcr  | 数组 (float[3])   | [x,y,z]              | portal_normal               | portal_schema.json:normal        |
| PortalWidth               | BigWorld_Standard_Portal.mcr  | 浮点数 (float)    | >0                   | portal_width                | portal_schema.json:width         |
| PortalHeight              | BigWorld_Standard_Portal.mcr  | 浮点数 (float)    | >0                   | portal_height               | portal_schema.json:height        |
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| addStandardPortal()       | BigWorld_Standard_Portal.mcr  | 函数              | 创建 Standard Portal | add_standard_portal         | portal_schema.json:add_standard  |
| removePortal()            | BigWorld_Standard_Portal.mcr  | 函数              | 删除 Portal           | remove_portal               | portal_schema.json:remove        |
| listPortals()             | BigWorld_Standard_Portal.mcr  | 函数              | 列出所有 Portal       | list_portals                | portal_schema.json:list          |
| validatePortal()          | BigWorld_Standard_Portal.mcr  | 函数              | 调用 Validator        | validate_portal             | validator_schema.json:portal     |
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI / Rollout 参数***                                                                                                                              
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| rollout_StandardPortalTools | BigWorld_Standard_Portal.mcr| rollout 面板      | UI 面板              | panel_standard_portal       | ui_schema.json:panel_standard    |
| btnAddStandardPortal      | BigWorld_Standard_Portal.mcr  | 按钮              | “Add Standard Portal”| btn_add_standard_portal     | ui_schema.json:btn_add_standard  |
| btnRemovePortal           | BigWorld_Standard_Portal.mcr  | 按钮              | “Remove Portal”      | btn_remove_portal           | ui_schema.json:btn_remove        |
| btnListPortals            | BigWorld_Standard_Portal.mcr  | 按钮              | “List Portals”       | btn_list_portals            | ui_schema.json:btn_list          |
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logPortalInfo(msg)        | BigWorld_Standard_Portal.mcr  | 函数              | 输出信息日志         | log_portal_info             | validator_schema.json:log_info   |
| logPortalError(code,msg)  | BigWorld_Standard_Portal.mcr  | 函数              | 输出错误日志         | log_portal_error            | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Standard_Portal.mcr  | 整数 (int)        | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Standard_Portal.mcr` 的迁移范围完整覆盖了：  
- **Portal 定义参数**（名称、类型=Standard、位置、法线、宽高）  
- **函数方法**（添加、删除、列出、校验）  
- **UI 面板参数**（rollout 面板、按钮）  
- **日志/错误处理**（信息、错误、最后错误状态）  

  

---

# 📑 BigWorld_Label_Portal.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                    | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+=============================+===================+======================+=============================+==================================+
| ***Portal 定义参数***                                                                                                                              
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| PortalName                | BigWorld_Label_Portal.mcr   | 字符串 (string)   | 任意字符串           | portal_name                 | portal_schema.json:name          |
| PortalType                | BigWorld_Label_Portal.mcr   | 枚举 (string)     | Label                | portal_type                 | portal_schema.json:type          |
| PortalPosition            | BigWorld_Label_Portal.mcr   | 数组 (float[3])   | [x,y,z]              | portal_position             | portal_schema.json:position      |
| PortalNormal              | BigWorld_Label_Portal.mcr   | 数组 (float[3])   | [x,y,z]              | portal_normal               | portal_schema.json:normal        |
| PortalLabel               | BigWorld_Label_Portal.mcr   | 字符串 (string)   | 用户输入标签         | portal_label                | portal_schema.json:label         |
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| addLabelPortal()          | BigWorld_Label_Portal.mcr   | 函数              | 创建 Label Portal     | add_label_portal            | portal_schema.json:add_label     |
| removePortal()            | BigWorld_Label_Portal.mcr   | 函数              | 删除 Portal           | remove_portal               | portal_schema.json:remove        |
| listPortals()             | BigWorld_Label_Portal.mcr   | 函数              | 列出所有 Portal       | list_portals                | portal_schema.json:list          |
| validatePortal()          | BigWorld_Label_Portal.mcr   | 函数              | 调用 Validator        | validate_portal             | validator_schema.json:portal     |
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI / Rollout 参数***                                                                                                                              
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| rollout_LabelPortalTools  | BigWorld_Label_Portal.mcr   | rollout 面板      | UI 面板              | panel_label_portal          | ui_schema.json:panel_label       |
| btnAddLabelPortal         | BigWorld_Label_Portal.mcr   | 按钮              | “Add Label Portal”   | btn_add_label_portal        | ui_schema.json:btn_add_label     |
| btnRemovePortal           | BigWorld_Label_Portal.mcr   | 按钮              | “Remove Portal”      | btn_remove_portal           | ui_schema.json:btn_remove        |
| btnListPortals            | BigWorld_Label_Portal.mcr   | 按钮              | “List Portals”       | btn_list_portals            | ui_schema.json:btn_list          |
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logPortalInfo(msg)        | BigWorld_Label_Portal.mcr   | 函数              | 输出信息日志         | log_portal_info             | validator_schema.json:log_info   |
| logPortalError(code,msg)  | BigWorld_Label_Portal.mcr   | 函数              | 输出错误日志         | log_portal_error            | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Label_Portal.mcr   | 整数 (int)        | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+-----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Label_Portal.mcr` 的迁移范围完整覆盖了：  
- **Portal 定义参数**（名称、类型=Label、位置、法线、标签字段）  
- **函数方法**（添加、删除、列出、校验）  
- **UI 面板参数**（rollout 面板、按钮）  
- **日志/错误处理**（信息、错误、最后错误状态）  



---

# 📑 BigWorld_Import_HardPoint.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                      | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+===============================+===================+======================+=============================+==================================+
| ***HardPoint 定义参数***                                                                                                                             
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| HardPointName             | BigWorld_Import_HardPoint.mcr | 字符串 (string)   | 任意字符串           | hardpoint_name              | hardpoint_schema.json:name       |
| HardPointType             | BigWorld_Import_HardPoint.mcr | 枚举 (string)     | Weapon/FX/Attach     | hardpoint_type              | hardpoint_schema.json:type       |
| HardPointPosition         | BigWorld_Import_HardPoint.mcr | 数组 (float[3])   | [x,y,z]              | hardpoint_position          | hardpoint_schema.json:position   |
| HardPointOrientation      | BigWorld_Import_HardPoint.mcr | 数组 (float[3x3]) | 矩阵                 | hardpoint_orientation       | hardpoint_schema.json:rotation   |
| HardPointScale            | BigWorld_Import_HardPoint.mcr | 浮点数 (float)    | 1.0                  | hardpoint_scale             | hardpoint_schema.json:scale      |
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| importHardPoint()         | BigWorld_Import_HardPoint.mcr | 函数              | 主导入入口           | import_hardpoint            | hardpoint_schema.json:import     |
| parseHardPointFile()      | BigWorld_Import_HardPoint.mcr | 函数              | 解析 .hardpoint 文件 | parse_hardpoint_file        | hardpoint_schema.json:parse      |
| attachHardPointToBone()   | BigWorld_Import_HardPoint.mcr | 函数              | 绑定到骨骼           | attach_hardpoint_to_bone     | hardpoint_schema.json:attach     |
| listHardPoints()          | BigWorld_Import_HardPoint.mcr | 函数              | 列出所有 HardPoint   | list_hardpoints             | hardpoint_schema.json:list       |
| validateHardPoint()       | BigWorld_Import_HardPoint.mcr | 函数              | 调用 Validator       | validate_hardpoint          | validator_schema.json:hardpoint  |
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI / Rollout 参数***                                                                                                                              
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| rollout_HardPointTools    | BigWorld_Import_HardPoint.mcr | rollout 面板      | UI 面板              | panel_hardpoint_tools       | ui_schema.json:panel_hardpoint   |
| btnImportHardPoint        | BigWorld_Import_HardPoint.mcr | 按钮              | “Import HardPoint”   | btn_import_hardpoint        | ui_schema.json:btn_import        |
| btnListHardPoints         | BigWorld_Import_HardPoint.mcr | 按钮              | “List HardPoints”    | btn_list_hardpoints         | ui_schema.json:btn_list          |
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logHardPointInfo(msg)     | BigWorld_Import_HardPoint.mcr | 函数              | 输出信息日志         | log_hardpoint_info          | validator_schema.json:log_info   |
| logHardPointError(code,msg)| BigWorld_Import_HardPoint.mcr| 函数              | 输出错误日志         | log_hardpoint_error         | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Import_HardPoint.mcr | 整数 (int)        | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+-------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Import_HardPoint.mcr` 的迁移范围完整覆盖了：  
- **HardPoint 定义参数**（名称、类型、位置、方向、缩放）  
- **函数方法**（导入、解析文件、绑定、列出、校验）  
- **UI 面板参数**（rollout 面板、按钮）  
- **日志/错误处理**（信息、错误、最后错误状态）  



---

# 📑 BigWorld_Make_BSP.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                   | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+============================+===================+======================+=============================+==================================+
| ***BSP 定义参数***                                                                                                                               
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| BSPName                   | BigWorld_Make_BSP.mcr      | 字符串 (string)   | 任意字符串           | bsp_name                    | bsp_schema.json:name             |
| BSPDepth                  | BigWorld_Make_BSP.mcr      | 整数 (int)        | 默认 8               | bsp_depth                   | bsp_schema.json:depth            |
| BSPTolerance              | BigWorld_Make_BSP.mcr      | 浮点数 (float)    | 0.01                 | bsp_tolerance               | bsp_schema.json:tolerance        |
| BSPOptimize               | BigWorld_Make_BSP.mcr      | 布尔值 (bool)     | true/false           | bsp_optimize                | bsp_schema.json:optimize         |
| BSPExportCollision        | BigWorld_Make_BSP.mcr      | 布尔值 (bool)     | true/false           | bsp_export_collision        | bsp_schema.json:collision        |
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                               
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| makeBSP()                 | BigWorld_Make_BSP.mcr      | 函数              | 主生成入口           | make_bsp                    | bsp_schema.json:make             |
| collectGeometryForBSP()   | BigWorld_Make_BSP.mcr      | 函数              | 收集几何体           | collect_geometry_for_bsp     | bsp_schema.json:geometry         |
| partitionGeometry()       | BigWorld_Make_BSP.mcr      | 函数              | 空间划分算法         | partition_geometry           | bsp_schema.json:partition        |
| optimizeBSP()             | BigWorld_Make_BSP.mcr      | 函数              | 优化 BSP 节点        | optimize_bsp                 | bsp_schema.json:optimize         |
| writeBSPFile()            | BigWorld_Make_BSP.mcr      | 函数              | 写出 BSP 数据        | write_bsp_file              | bsp_schema.json:write            |
| validateBeforeExport()    | BigWorld_Make_BSP.mcr      | 函数              | 调用 Validator       | validate_before_export       | validator_schema.json:precheck   |
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI / Rollout 参数***                                                                                                                          
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| rollout_BSPTools          | BigWorld_Make_BSP.mcr      | rollout 面板      | UI 面板              | panel_bsp_tools             | ui_schema.json:panel_bsp         |
| btnMakeBSP                | BigWorld_Make_BSP.mcr      | 按钮              | “Make BSP”           | btn_make_bsp                | ui_schema.json:btn_make          |
| chkOptimize               | BigWorld_Make_BSP.mcr      | 复选框            | 是否优化             | chk_optimize                | ui_schema.json:chk_optimize      |
| chkExportCollision        | BigWorld_Make_BSP.mcr      | 复选框            | 是否导出碰撞         | chk_export_collision        | ui_schema.json:chk_collision     |
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                            
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logBSPInfo(msg)           | BigWorld_Make_BSP.mcr      | 函数              | 输出信息日志         | log_bsp_info                | validator_schema.json:log_info   |
| logBSPError(code,msg)     | BigWorld_Make_BSP.mcr      | 函数              | 输出错误日志         | log_bsp_error               | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Make_BSP.mcr      | 整数 (int)        | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+----------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Make_BSP.mcr` 的迁移范围完整覆盖了：  
- **BSP 定义参数**（名称、深度、容差、优化、碰撞导出）  
- **函数方法**（生成、收集几何、划分、优化、写出、校验）  
- **UI 面板参数**（rollout 面板、按钮、复选框）  
- **日志/错误处理**（信息、错误、最后错误状态）  


---

# 📑 BigWorld_Make_CustomHull.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                       | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+================================+===================+======================+=============================+==================================+
| ***Hull 定义参数***                                                                                                                               
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| HullName                  | BigWorld_Make_CustomHull.mcr   | 字符串 (string)   | 任意字符串           | hull_name                   | hull_schema.json:name            |
| HullType                  | BigWorld_Make_CustomHull.mcr   | 枚举 (string)     | Convex/Concave       | hull_type                   | hull_schema.json:type            |
| HullResolution            | BigWorld_Make_CustomHull.mcr   | 整数 (int)        | 默认 16              | hull_resolution             | hull_schema.json:resolution      |
| HullTolerance             | BigWorld_Make_CustomHull.mcr   | 浮点数 (float)    | 0.01                 | hull_tolerance              | hull_schema.json:tolerance       |
| HullOptimize              | BigWorld_Make_CustomHull.mcr   | 布尔值 (bool)     | true/false           | hull_optimize               | hull_schema.json:optimize        |
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| makeCustomHull()          | BigWorld_Make_CustomHull.mcr   | 函数              | 主生成入口           | make_custom_hull            | hull_schema.json:make            |
| collectGeometryForHull()  | BigWorld_Make_CustomHull.mcr   | 函数              | 收集几何体           | collect_geometry_for_hull    | hull_schema.json:geometry        |
| generateConvexHull()      | BigWorld_Make_CustomHull.mcr   | 函数              | 生成凸包             | generate_convex_hull         | hull_schema.json:convex          |
| generateConcaveHull()     | BigWorld_Make_CustomHull.mcr   | 函数              | 生成凹壳             | generate_concave_hull        | hull_schema.json:concave         |
| optimizeHull()            | BigWorld_Make_CustomHull.mcr   | 函数              | 优化 Hull 节点       | optimize_hull                | hull_schema.json:optimize        |
| writeHullFile()           | BigWorld_Make_CustomHull.mcr   | 函数              | 写出 Hull 数据       | write_hull_file              | hull_schema.json:write           |
| validateBeforeExport()    | BigWorld_Make_CustomHull.mcr   | 函数              | 调用 Validator       | validate_before_export       | validator_schema.json:precheck   |
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI / Rollout 参数***                                                                                                                              
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| rollout_HullTools         | BigWorld_Make_CustomHull.mcr   | rollout 面板      | UI 面板              | panel_hull_tools             | ui_schema.json:panel_hull        |
| btnMakeHull               | BigWorld_Make_CustomHull.mcr   | 按钮              | “Make Hull”          | btn_make_hull                | ui_schema.json:btn_make          |
| chkOptimize               | BigWorld_Make_CustomHull.mcr   | 复选框            | 是否优化             | chk_optimize                 | ui_schema.json:chk_optimize      |
| ddlHullType               | BigWorld_Make_CustomHull.mcr   | 下拉框            | Convex/Concave       | ddl_hull_type                | ui_schema.json:ddl_type          |
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logHullInfo(msg)          | BigWorld_Make_CustomHull.mcr   | 函数              | 输出信息日志         | log_hull_info                | validator_schema.json:log_info   |
| logHullError(code,msg)    | BigWorld_Make_CustomHull.mcr   | 函数              | 输出错误日志         | log_hull_error               | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Make_CustomHull.mcr   | 整数 (int)        | 0                    | last_error_code              | validator_schema.json:last_error |
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Make_CustomHull.mcr` 的迁移范围完整覆盖了：  
- **Hull 定义参数**（名称、类型、分辨率、容差、优化）  
- **函数方法**（生成、收集几何、凸包/凹壳生成、优化、写出、校验）  
- **UI 面板参数**（rollout 面板、按钮、复选框、下拉框）  
- **日志/错误处理**（信息、错误、最后错误状态）  



---

# 📑 BigWorld_Munge_Normals.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                       | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+================================+===================+======================+=============================+==================================+
| ***法线处理参数***                                                                                                                               
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| RecalculateNormals        | BigWorld_Munge_Normals.mcr     | 布尔值 (bool)     | true/false           | recalc_normals              | normals_schema.json:recalc       |
| UnifyNormals              | BigWorld_Munge_Normals.mcr     | 布尔值 (bool)     | true/false           | unify_normals               | normals_schema.json:unify        |
| SmoothNormals             | BigWorld_Munge_Normals.mcr     | 布尔值 (bool)     | true/false           | smooth_normals              | normals_schema.json:smooth       |
| SmoothingAngle            | BigWorld_Munge_Normals.mcr     | 浮点数 (float)    | 30.0 (度)            | smoothing_angle             | normals_schema.json:angle        |
| PreserveHardEdges         | BigWorld_Munge_Normals.mcr     | 布尔值 (bool)     | true/false           | preserve_hard_edges         | normals_schema.json:hard_edges   |
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| mungeNormals()            | BigWorld_Munge_Normals.mcr     | 函数              | 主处理入口           | munge_normals               | normals_schema.json:munge        |
| recalcNormals()           | BigWorld_Munge_Normals.mcr     | 函数              | 重算法线             | recalc_normals              | normals_schema.json:recalc       |
| unifyNormals()            | BigWorld_Munge_Normals.mcr     | 函数              | 统一法线方向         | unify_normals               | normals_schema.json:unify        |
| smoothNormals()           | BigWorld_Munge_Normals.mcr     | 函数              | 平滑法线             | smooth_normals              | normals_schema.json:smooth       |
| preserveHardEdges()       | BigWorld_Munge_Normals.mcr     | 函数              | 保留硬边             | preserve_hard_edges         | normals_schema.json:hard_edges   |
| validateBeforeExport()    | BigWorld_Munge_Normals.mcr     | 函数              | 调用 Validator       | validate_before_export       | validator_schema.json:precheck   |
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI / Rollout 参数***                                                                                                                              
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| rollout_NormalTools       | BigWorld_Munge_Normals.mcr     | rollout 面板      | UI 面板              | panel_normal_tools          | ui_schema.json:panel_normals     |
| btnMungeNormals           | BigWorld_Munge_Normals.mcr     | 按钮              | “Munge Normals”      | btn_munge_normals           | ui_schema.json:btn_munge         |
| chkRecalc                 | BigWorld_Munge_Normals.mcr     | 复选框            | 是否重算             | chk_recalc                  | ui_schema.json:chk_recalc        |
| chkUnify                  | BigWorld_Munge_Normals.mcr     | 复选框            | 是否统一             | chk_unify                   | ui_schema.json:chk_unify         |
| chkSmooth                 | BigWorld_Munge_Normals.mcr     | 复选框            | 是否平滑             | chk_smooth                  | ui_schema.json:chk_smooth        |
| spnSmoothingAngle         | BigWorld_Munge_Normals.mcr     | 数值输入框        | 平滑角度             | spn_smoothing_angle         | ui_schema.json:spn_angle         |
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logNormalInfo(msg)        | BigWorld_Munge_Normals.mcr     | 函数              | 输出信息日志         | log_normal_info             | validator_schema.json:log_info   |
| logNormalError(code,msg)  | BigWorld_Munge_Normals.mcr     | 函数              | 输出错误日志         | log_normal_error            | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Munge_Normals.mcr     | 整数 (int)        | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Munge_Normals.mcr` 的迁移范围完整覆盖了：  
- **法线处理参数**（重算、统一、平滑、角度、硬边保留）  
- **函数方法**（主入口、重算、统一、平滑、硬边保留、校验）  
- **UI 面板参数**（rollout 面板、按钮、复选框、数值输入框）  
- **日志/错误处理**（信息、错误、最后错误状态）  


---

# 📑 BigWorld_Object_Divider.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                       | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+================================+===================+======================+=============================+==================================+
| ***对象拆分参数***                                                                                                                               
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| DividerName               | BigWorld_Object_Divider.mcr    | 字符串 (string)   | 任意字符串           | divider_name                | divider_schema.json:name         |
| MaxVerticesPerObject      | BigWorld_Object_Divider.mcr    | 整数 (int)        | 默认 65535           | max_vertices_per_object     | divider_schema.json:max_vertices |
| MaxFacesPerObject         | BigWorld_Object_Divider.mcr    | 整数 (int)        | 默认 65535           | max_faces_per_object        | divider_schema.json:max_faces    |
| PreserveHierarchy         | BigWorld_Object_Divider.mcr    | 布尔值 (bool)     | true/false           | preserve_hierarchy          | divider_schema.json:hierarchy    |
| GenerateNamingSuffix      | BigWorld_Object_Divider.mcr    | 布尔值 (bool)     | true/false           | generate_naming_suffix      | divider_schema.json:naming       |
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| divideObject()            | BigWorld_Object_Divider.mcr    | 函数              | 主拆分入口           | divide_object               | divider_schema.json:divide       |
| splitByVertices()         | BigWorld_Object_Divider.mcr    | 函数              | 按顶点数拆分         | split_by_vertices           | divider_schema.json:split_verts  |
| splitByFaces()            | BigWorld_Object_Divider.mcr    | 函数              | 按面数拆分           | split_by_faces              | divider_schema.json:split_faces  |
| preserveObjectHierarchy() | BigWorld_Object_Divider.mcr    | 函数              | 保留层级关系         | preserve_object_hierarchy   | divider_schema.json:hierarchy    |
| renameDividedObjects()    | BigWorld_Object_Divider.mcr    | 函数              | 自动命名             | rename_divided_objects      | divider_schema.json:rename       |
| validateBeforeExport()    | BigWorld_Object_Divider.mcr    | 函数              | 调用 Validator       | validate_before_export      | validator_schema.json:precheck   |
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI / Rollout 参数***                                                                                                                              
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| rollout_ObjectDividerTools| BigWorld_Object_Divider.mcr    | rollout 面板      | UI 面板              | panel_object_divider        | ui_schema.json:panel_divider     |
| btnDivideObject           | BigWorld_Object_Divider.mcr    | 按钮              | “Divide Object”      | btn_divide_object           | ui_schema.json:btn_divide        |
| chkPreserveHierarchy      | BigWorld_Object_Divider.mcr    | 复选框            | 是否保留层级         | chk_preserve_hierarchy      | ui_schema.json:chk_hierarchy     |
| chkGenerateSuffix         | BigWorld_Object_Divider.mcr    | 复选框            | 是否生成后缀         | chk_generate_suffix         | ui_schema.json:chk_suffix        |
| spnMaxVertices            | BigWorld_Object_Divider.mcr    | 数值输入框        | 最大顶点数           | spn_max_vertices            | ui_schema.json:spn_vertices      |
| spnMaxFaces               | BigWorld_Object_Divider.mcr    | 数值输入框        | 最大面数             | spn_max_faces               | ui_schema.json:spn_faces         |
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logDividerInfo(msg)       | BigWorld_Object_Divider.mcr    | 函数              | 输出信息日志         | log_divider_info            | validator_schema.json:log_info   |
| logDividerError(code,msg) | BigWorld_Object_Divider.mcr    | 函数              | 输出错误日志         | log_divider_error           | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Object_Divider.mcr    | 整数 (int)        | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+--------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Object_Divider.mcr` 的迁移范围完整覆盖了：  
- **对象拆分参数**（最大顶点数、最大面数、层级保留、命名规则）  
- **函数方法**（拆分、按顶点/面数切分、保留层级、重命名、校验）  
- **UI 面板参数**（rollout 面板、按钮、复选框、数值输入框）  
- **日志/错误处理**（信息、错误、最后错误状态）  

  

---

# 📑 BigWorld_Prefab_Assembler.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+---------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                        | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+=================================+===================+======================+=============================+==================================+
| ***Prefab 定义参数***                                                                                                                              
+---------------------------+---------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| PrefabName                | BigWorld_Prefab_Assembler.mcr   | 字符串 (string)   | 任意字符串           | prefab_name                 | prefab_schema.json:name          |
| PrefabRoot                | BigWorld_Prefab_Assembler.mcr   | 节点 (node)       | 选中对象             | prefab_root                 | prefab_schema.json:root          |
| IncludeChildren           | BigWorld_Prefab_Assembler.mcr   | 布尔值 (bool)     | true/false           | include_children            | prefab_schema.json:children      |
| PreserveTransforms        | BigWorld_Prefab_Assembler.mcr   | 布尔值 (bool)     | true/false           | preserve_transforms         | prefab_schema.json:transforms    |
| ExportAsSingleFile        | BigWorld_Prefab_Assembler.mcr   | 布尔值 (bool)     | true/false           | export_as_single_file       | prefab_schema.json:single_file   |
+---------------------------+---------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+---------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| assemblePrefab()          | BigWorld_Prefab_Assembler.mcr   | 函数              | 主组装入口           | assemble_prefab             | prefab_schema.json:assemble      |
| collectPrefabObjects()    | BigWorld_Prefab_Assembler.mcr   | 函数              | 收集对象列表         | collect_prefab_objects      | prefab_schema.json:objects       |
| bakePrefabTransforms()    | BigWorld_Prefab_Assembler.mcr   | 函数              | 烘焙变换矩阵         | bake_prefab_transforms      | prefab_schema.json:transforms    |
| writePrefabFile()         | BigWorld_Prefab_Assembler.mcr   | 函数              | 写出 Prefab 文件     | write_prefab_file           | prefab_schema.json:write         |
| validateBeforeExport()    | BigWorld_Prefab_Assembler.mcr   | 函数              | 调用 Validator       | validate_before_export      | validator_schema.json:precheck   |
+---------------------------+---------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI / Rollout 参数***                                                                                                                              
+---------------------------+---------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| rollout_PrefabTools       | BigWorld_Prefab_Assembler.mcr   | rollout 面板      | UI 面板              | panel_prefab_tools          | ui_schema.json:panel_prefab      |
| btnAssemblePrefab         | BigWorld_Prefab_Assembler.mcr   | 按钮              | “Assemble Prefab”    | btn_assemble_prefab         | ui_schema.json:btn_assemble      |
| chkIncludeChildren        | BigWorld_Prefab_Assembler.mcr   | 复选框            | 是否包含子对象       | chk_include_children        | ui_schema.json:chk_children      |
| chkPreserveTransforms     | BigWorld_Prefab_Assembler.mcr   | 复选框            | 是否保留变换         | chk_preserve_transforms     | ui_schema.json:chk_transforms    |
| chkExportSingleFile       | BigWorld_Prefab_Assembler.mcr   | 复选框            | 是否单文件导出       | chk_export_single_file      | ui_schema.json:chk_single        |
+---------------------------+---------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+---------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logPrefabInfo(msg)        | BigWorld_Prefab_Assembler.mcr   | 函数              | 输出信息日志         | log_prefab_info             | validator_schema.json:log_info   |
| logPrefabError(code,msg)  | BigWorld_Prefab_Assembler.mcr   | 函数              | 输出错误日志         | log_prefab_error            | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Prefab_Assembler.mcr   | 整数 (int)        | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+---------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Prefab_Assembler.mcr` 的迁移范围完整覆盖了：  
- **Prefab 定义参数**（名称、根节点、子对象、变换、单文件导出）  
- **函数方法**（组装、收集对象、烘焙变换、写出文件、校验）  
- **UI 面板参数**（rollout 面板、按钮、复选框）  
- **日志/错误处理**（信息、错误、最后错误状态）  



---

# 📑 BigWorld_Modify_Res_Paths.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                         | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+==================================+===================+======================+=============================+==================================+
| ***路径修改参数***                                                                                                                               
+---------------------------+----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| OldPath                   | BigWorld_Modify_Res_Paths.mcr    | 字符串 (string)   | 用户输入             | old_path                    | respath_schema.json:old          |
| NewPath                   | BigWorld_Modify_Res_Paths.mcr    | 字符串 (string)   | 用户输入             | new_path                    | respath_schema.json:new          |
| PathType                  | BigWorld_Modify_Res_Paths.mcr    | 枚举 (string)     | Texture/Model/Anim   | path_type                   | respath_schema.json:type         |
| ApplyRecursively          | BigWorld_Modify_Res_Paths.mcr    | 布尔值 (bool)     | true/false           | apply_recursively           | respath_schema.json:recursive    |
| BackupBeforeModify        | BigWorld_Modify_Res_Paths.mcr    | 布尔值 (bool)     | true/false           | backup_before_modify        | respath_schema.json:backup       |
+---------------------------+----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| modifyResPaths()          | BigWorld_Modify_Res_Paths.mcr    | 函数              | 主修改入口           | modify_res_paths            | respath_schema.json:modify       |
| findResourcesByPath()     | BigWorld_Modify_Res_Paths.mcr    | 函数              | 查找资源引用         | find_resources_by_path      | respath_schema.json:find         |
| replaceResourcePath()     | BigWorld_Modify_Res_Paths.mcr    | 函数              | 替换路径             | replace_resource_path       | respath_schema.json:replace      |
| backupResourceFiles()     | BigWorld_Modify_Res_Paths.mcr    | 函数              | 备份资源文件         | backup_resource_files       | respath_schema.json:backup       |
| validatePaths()           | BigWorld_Modify_Res_Paths.mcr    | 函数              | 调用 Validator       | validate_paths              | validator_schema.json:paths      |
+---------------------------+----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI / Rollout 参数***                                                                                                                              
+---------------------------+----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| rollout_PathTools         | BigWorld_Modify_Res_Paths.mcr    | rollout 面板      | UI 面板              | panel_path_tools            | ui_schema.json:panel_paths       |
| btnModifyPaths            | BigWorld_Modify_Res_Paths.mcr    | 按钮              | “Modify Paths”       | btn_modify_paths            | ui_schema.json:btn_modify        |
| btnFindResources          | BigWorld_Modify_Res_Paths.mcr    | 按钮              | “Find Resources”     | btn_find_resources          | ui_schema.json:btn_find          |
| chkApplyRecursively       | BigWorld_Modify_Res_Paths.mcr    | 复选框            | 是否递归             | chk_apply_recursively       | ui_schema.json:chk_recursive     |
| chkBackupBeforeModify     | BigWorld_Modify_Res_Paths.mcr    | 复选框            | 是否备份             | chk_backup_before_modify    | ui_schema.json:chk_backup        |
+---------------------------+----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logPathInfo(msg)          | BigWorld_Modify_Res_Paths.mcr    | 函数              | 输出信息日志         | log_path_info               | validator_schema.json:log_info   |
| logPathError(code,msg)    | BigWorld_Modify_Res_Paths.mcr    | 函数              | 输出错误日志         | log_path_error              | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Modify_Res_Paths.mcr    | 整数 (int)        | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Modify_Res_Paths.mcr` 的迁移范围完整覆盖了：  
- **路径修改参数**（旧路径、新路径、类型、递归、备份）  
- **函数方法**（查找、替换、备份、校验）  
- **UI 面板参数**（rollout 面板、按钮、复选框）  
- **日志/错误处理**（信息、错误、最后错误状态）  




---

# 📑 BigWorld_Verify_File_Paths.mcr 字段提炼表（分类版 · 完整）

```
+---------------------------+-----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| 字段名 (MaxScript)        | 来源文件                          | 字段类型           | 默认值/取值范围       | Blender Python 对应名称      | Schema/JSON 映射字段              |
+===========================+===================================+===================+======================+=============================+==================================+
| ***路径校验参数***                                                                                                                               
+---------------------------+-----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| FilePath                  | BigWorld_Verify_File_Paths.mcr    | 字符串 (string)   | 用户输入             | file_path                   | filepath_schema.json:path        |
| PathType                  | BigWorld_Verify_File_Paths.mcr    | 枚举 (string)     | Texture/Model/Anim   | path_type                   | filepath_schema.json:type        |
| CheckExistence            | BigWorld_Verify_File_Paths.mcr    | 布尔值 (bool)     | true/false           | check_existence             | filepath_schema.json:exist       |
| CheckCaseSensitivity      | BigWorld_Verify_File_Paths.mcr    | 布尔值 (bool)     | true/false           | check_case_sensitivity      | filepath_schema.json:case        |
| CheckRelativePaths        | BigWorld_Verify_File_Paths.mcr    | 布尔值 (bool)     | true/false           | check_relative_paths        | filepath_schema.json:relative    |
+---------------------------+-----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***函数 / 方法***                                                                                                                                   
+---------------------------+-----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| verifyFilePaths()         | BigWorld_Verify_File_Paths.mcr    | 函数              | 主校验入口           | verify_file_paths           | filepath_schema.json:verify      |
| checkExistence()          | BigWorld_Verify_File_Paths.mcr    | 函数              | 检查文件是否存在     | check_existence             | filepath_schema.json:exist       |
| checkCaseSensitivity()    | BigWorld_Verify_File_Paths.mcr    | 函数              | 检查大小写一致性     | check_case_sensitivity      | filepath_schema.json:case        |
| checkRelativePaths()      | BigWorld_Verify_File_Paths.mcr    | 函数              | 检查相对路径合法性   | check_relative_paths        | filepath_schema.json:relative    |
| reportInvalidPaths()      | BigWorld_Verify_File_Paths.mcr    | 函数              | 输出错误路径报告     | report_invalid_paths        | filepath_schema.json:report      |
+---------------------------+-----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***UI / Rollout 参数***                                                                                                                              
+---------------------------+-----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| rollout_VerifyPathsTools  | BigWorld_Verify_File_Paths.mcr    | rollout 面板      | UI 面板              | panel_verify_paths          | ui_schema.json:panel_verify      |
| btnVerifyPaths            | BigWorld_Verify_File_Paths.mcr    | 按钮              | “Verify Paths”       | btn_verify_paths            | ui_schema.json:btn_verify        |
| chkCheckExistence         | BigWorld_Verify_File_Paths.mcr    | 复选框            | 是否检查存在         | chk_check_existence         | ui_schema.json:chk_exist         |
| chkCaseSensitive          | BigWorld_Verify_File_Paths.mcr    | 复选框            | 是否区分大小写       | chk_case_sensitive          | ui_schema.json:chk_case          |
| chkRelativePaths          | BigWorld_Verify_File_Paths.mcr    | 复选框            | 是否检查相对路径     | chk_relative_paths          | ui_schema.json:chk_relative      |
+---------------------------+-----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| ***日志 / 错误处理***                                                                                                                              
+---------------------------+-----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
| logPathVerifyInfo(msg)    | BigWorld_Verify_File_Paths.mcr    | 函数              | 输出信息日志         | log_path_verify_info        | validator_schema.json:log_info   |
| logPathVerifyError(code,msg)| BigWorld_Verify_File_Paths.mcr  | 函数              | 输出错误日志         | log_path_verify_error       | validator_schema.json:log_error  |
| lastErrorCode             | BigWorld_Verify_File_Paths.mcr    | 整数 (int)        | 0                    | last_error_code             | validator_schema.json:last_error |
+---------------------------+-----------------------------------+-------------------+----------------------+-----------------------------+----------------------------------+
```

---

# 🔹 总结
这样整理后，`BigWorld_Verify_File_Paths.mcr` 的迁移范围完整覆盖了：  
- **路径校验参数**（文件路径、类型、存在性、大小写、相对路径）  
- **函数方法**（校验、检查存在、检查大小写、检查相对路径、输出报告）  
- **UI 面板参数**（rollout 面板、按钮、复选框）  
- **日志/错误处理**（信息、错误、最后错误状态）  



---

# 报告结构说明

- 概述：模块职责与上下文
- 输入与前置条件：接受的数据、状态、依赖
- 导出的接口：函数、数据结构、常量
- 内部流程与调用关系：主要逻辑、边界处理
- 数据契约与Schema对齐：字段、类型、默认值、约束
- UI/指令入口：rollout、按钮、命令
- 校验与错误处理：Validator集成、错误码、日志
- 迁移到Blender的实现要点：Python模块、API映射、风险
- 测试清单：用例、断言、自动化
- 风险与TODO：未知点、补充文档需求

---

# BigWorld_Common.ms 深度报告

## 概述
- 模块职责：提供全局常量、路径与文件名规则、通用工具函数（日志、字符串、集合、文件I/O）、统一数据规范的公共入口。
- 上下文位置：被所有 mcr/ms 文件作为基础依赖引入，属于“平台层”的公共库。

## 输入与前置条件
- 输入数据：无显式外部输入；作为依赖模块被其他脚本调用。
- 前置条件：3ds Max 环境可用；文件系统读写权限；BigWorld 项目目录结构已配置。
- 依赖模块：无强依赖，但通常与 Validator 共用日志格式。

## 导出的接口
- 常量：
  - PATH_SEP、ROOT_RES_DIR、DEFAULT_EXPORT_DIR、FILE_EXTS（visual/animation/xml等）
- 规则/正则：
  - VALID_NAME_REGEX（资源命名规范）、SUPPORTED_MATERIAL_TYPES
- 通用函数：
  - path_join(parts...)：路径组装与标准化
  - ensure_dir(path)：目录存在性保证
  - sanitize_name(name)：资源名清洗
  - unique_name(name, existingSet)：冲突解决
  - write_json(path, obj)、read_json(path)
  - log_info(msg)、log_warn(msg)、log_error(code, msg)
- 数据结构：
  - ExportContext：导出会话上下文（export_path、timestamp、user、options）

## 内部流程与调用关系
- 名称与路径处理链：
  1. sanitize_name → VALID_NAME_REGEX 校验
  2. path_join + ROOT_RES_DIR 前缀规则
  3. ensure_dir（幂等）
- 日志统一：
  - log_* 调用同一格式化器，输出 time/user/module、code、message
- 写读工具：
  - JSON/XML 存取封装，捕获文件异常并返回错误码给 Validator

## 数据契约与Schema对齐
- common_schema.json（建议字段）：
  - properties
    - path_sep: string
    - root_res_dir: string
    - default_export_dir: string
    - file_exts: object { visual:string, animation:string, xml:string, bsp:string, hull:string, prefab:string }
    - valid_name_regex: string
    - supported_material_types: array[string]
  - required: [root_res_dir, default_export_dir, file_exts]
  - additionalProperties: false

## UI/指令入口
- 无 UI；在 Startup 中作为公共库加载。
- 可能暴露 MaxScript 命令别名供其他脚本调用（如 bw_path_join）。

## 校验与错误处理
- 错误码范围（建议统一）：
  - 100x 路径/文件错误（不存在、权限、无效字符）
  - 200x 命名错误（非法字符、冲突）
  - 300x 序列化错误（JSON/XML失败）
- 与 Validator 集成：
  - log_error(code, msg) 同步到 Validator，形成统一报告。

## 迁移到Blender的实现要点
- Python模块建议：core/common.py
  - 提供与上面接口一致的函数与常量。
- API映射：
  - path_join → os.path.join + 统一斜杠
  - ensure_dir → pathlib.Path(...).mkdir(parents=True, exist_ok=True)
  - write_json/read_json → json.dump/json.load，编码统一为 UTF-8
- 风险：
  - Windows/Unix 路径分隔差异
  - 非ASCII资源名（中文）兼容性
  - 相对路径与Blender项目根目录的绑定策略（需与团队约定）

## 测试清单
- 名称清洗：非法字符、前后空格、重复名冲突
- 路径组合：多段join、绝对/相对、跨平台分隔符
- 目录保证：已有/无、权限异常
- JSON读写：空对象、大对象、异常捕获
- 日志格式：包含时间戳、模块名、错误码

## 风险与TODO
- VALID_NAME_REGEX 与历史数据的兼容性需确认（请提供旧资源示例）
- supported_material_types 与引擎版本是否有差异（需要版本表）
- ExportContext 字段的最终版定义需要团队确认（用户信息来源、会话ID）

---

# BigWorld_Startup.ms 深度报告

## 概述
- 模块职责：注册所有rollout面板、菜单与命令；加载公共与子模块；初始化全局配置与Validator。
- 上下文位置：插件入口，保证 Max 打开后工具可用。

## 输入与前置条件
- 输入：Max启动事件、用户环境变量（项目路径）
- 前置条件：Common可加载；模块路径正确；UI资源可用

## 导出的接口
- init_plugin()：初始化入口
- register_ui()：注册四大主面板（Export/Import/Geometry/Tools）
- register_commands()：命令绑定，方便快捷键触发
- load_modules()：按类别加载 mcr/ms

## 内部流程与调用关系
1. load_modules（common → validator → export/import/geometry/portal/prefab/paths）
2. validator.bootstrap（设置日志路径、错误码集）
3. register_ui（创建rollout面板与按钮）
4. register_commands（导出快捷命令）

## 数据契约与Schema对齐
- startup_schema.json（建议字段）：
  - panels: array[string]（"Export","Import","Geometry","Tools"）
  - modules_loaded: array[string]
  - validator_ready: boolean
  - commands: array[object{name:string, target:string}]

## UI/指令入口
- 无单独业务UI，但负责把各子面板挂载到主UI框架

## 校验与错误处理
- 缺模块、UI资源加载失败、命令注册冲突 → 统一log_error并阻断

## 迁移到Blender的实现要点
- Python模块：core/startup.py
- 集成：
  - 注册 Blender 面板（bpy.types.Panel）
  - 菜单/操作符（bpy.types.Operator）
  - 模块加载用延迟导入，避免启动卡顿

## 测试清单
- 所有面板是否出现、按钮是否绑定
- 模块加载顺序是否正确（Validator优先）
- 命令调用是否能触发对应功能

## 风险与TODO
- Blender启动顺序与Max不同，需适配 lazy-load
- 扩展性要求：新模块增加不破坏旧注册流程

---


---

# BigWorld_Validator.ms 深度报告

## 概述
- **模块职责**：统一的校验与日志系统，负责在导出/导入/生成过程中检查数据合法性，输出错误、警告和信息日志。
- **上下文位置**：所有导出、几何、Portal、路径工具都会调用它，是全局的“守门人”。

## 输入与前置条件
- **输入数据**：任意待校验的数据结构（Visual、Animation、HitBox、Portal、路径等）。
- **前置条件**：Common 已加载（提供日志与路径工具）。
- **依赖模块**：Common（日志格式）、MaxScript 系统函数。

## 导出的接口
- **函数**：
  - `validate_visual(data)`：检查 Visual 导出数据（LOD、材质、路径）。
  - `validate_animation(data)`：检查动画数据（帧范围、骨骼绑定）。
  - `validate_hitbox(data)`：检查 HitBox 定义（骨骼、尺寸）。
  - `validate_portal(data)`：检查 Portal 定义（位置、法线、尺寸）。
  - `validate_paths(data)`：检查路径（存在性、大小写、相对路径）。
- **日志接口**：
  - `log_info(msg)`
  - `log_warn(msg)`
  - `log_error(code, msg)`
- **状态变量**：
  - `lastErrorCode`：最近一次错误码
  - `errorCount` / `warnCount`：统计

## 内部流程与调用关系
1. 接收数据结构（如 Visual 导出上下文）。
2. 按 schema 校验字段完整性、类型、取值范围。
3. 发现问题 → 调用 `log_error` 或 `log_warn`。
4. 返回布尔值或错误码，供上层决定是否中断。

## 数据契约与 Schema 对齐
- **validator_schema.json**（建议字段）：
  ```json
  {
    "type": "object",
    "properties": {
      "lastErrorCode": { "type": "integer" },
      "errorCount": { "type": "integer" },
      "warnCount": { "type": "integer" },
      "logs": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "level": { "type": "string", "enum": ["info","warn","error"] },
            "code": { "type": "integer" },
            "message": { "type": "string" }
          },
          "required": ["level","message"]
        }
      }
    },
    "required": ["lastErrorCode","logs"]
  }
  ```

## UI / 指令入口
- 无独立 UI；通过其他模块的按钮触发（如 Export Visual → validate_visual）。
- 可能有一个“Validator Report”面板显示日志。

## 校验与错误处理
- **错误码分层**：
  - 1000–1999：路径/文件错误
  - 2000–2999：数据缺失/字段错误
  - 3000–3999：几何/法线错误
  - 4000–4999：Portal/HitBox 错误
- **日志输出**：统一格式 `[时间][模块][级别][错误码] 消息`

## 迁移到 Blender 的实现要点
- Python 模块：`core/validator.py`
- 使用 `jsonschema` 校验数据结构。
- 日志系统可对接 Blender 的 `report({'INFO'/'ERROR'}, msg)`。
- 保持错误码一致，方便团队追踪。

## 测试清单
- Visual 导出缺少 LOD → 报错
- Animation 帧范围非法 → 报错
- HitBox 骨骼不存在 → 报错
- Portal 法线为零向量 → 报错
- 路径大小写错误 → 报错
- 日志统计是否正确（errorCount、warnCount）

## 风险与 TODO
- 错误码表需要团队确认并冻结，避免迁移后不一致。
- 日志输出是否需要写入文件（Blender 插件中可选）。
- 是否需要国际化（中英文日志）。

---


---

# BigWorld_Export_Visual.mcr 深度报告

## 概述
- **模块职责**：  
  将 3ds Max 中的几何体、材质、LOD（Level of Detail）、法线、UV 等信息导出为 BigWorld 的 `.visual` 文件。  
- **上下文位置**：  
  属于导出类的核心文件，通常是团队使用频率最高的工具之一。所有模型资源的导出都要经过它。

---

## 输入与前置条件
- **输入数据**：  
  - 用户在 Max 中选中的模型对象  
  - 材质信息（Standard、Multi/Sub-Object 等）  
  - LOD 设置（LOD0、LOD1、LOD2…）  
  - 导出路径（用户指定或默认路径）  
- **前置条件**：  
  - Common 模块可用（路径、日志、文件写入工具）  
  - Validator 模块可用（校验导出数据完整性）  
  - 模型必须满足基本要求（非空、合法材质、拓扑正确）

---

## 导出的接口
- **函数**：
  - `exportVisual()`：主导出入口  
  - `collectGeometry()`：收集几何体数据（顶点、面、UV）  
  - `collectMaterials()`：收集材质信息  
  - `collectLODs()`：收集 LOD 层级  
  - `writeVisualFile()`：写出 `.visual` 文件  
  - `validateBeforeExport()`：调用 Validator 校验  
- **数据结构**：
  - `VisualData`：包含 geometry、materials、lods、normals、uvs、export_path

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `exportVisual()`  
2. **收集数据**：调用 `collectGeometry`、`collectMaterials`、`collectLODs`  
3. **校验**：调用 `validateBeforeExport`，检查字段完整性、材质合法性、LOD 层级  
4. **写出文件**：调用 `writeVisualFile`，生成 `.visual` 文件  
5. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **visual_schema.json**（建议字段）：  
  ```json
  {
    "type": "object",
    "properties": {
      "visual_name": { "type": "string" },
      "geometry": { "type": "array", "items": { "type": "object" } },
      "materials": { "type": "array", "items": { "type": "string" } },
      "lod_levels": { "type": "array", "items": { "type": "string" } },
      "normals": { "type": "array", "items": { "type": "array", "items": { "type": "number" } } },
      "uvs": { "type": "array", "items": { "type": "array", "items": { "type": "number" } } },
      "export_path": { "type": "string" }
    },
    "required": ["visual_name","geometry","materials","export_path"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_VisualExportTools`  
- **按钮**：  
  - `btnExportVisual` → “Export Visual”  
  - `btnSetExportPath` → 设置导出路径  
  - `chkIncludeLODs` → 是否导出 LOD  
  - `chkExportNormals` → 是否导出法线  

---

## 校验与错误处理
- **常见错误**：  
  - 未选择对象 → 报错  
  - 材质缺失或不支持 → 报错  
  - LOD 层级不完整 → 警告  
  - 导出路径无效 → 报错  
- **错误码建议**：  
  - 2101：未选择对象  
  - 2102：材质不合法  
  - 2103：LOD 缺失  
  - 2104：路径错误  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`export/visual_export.py`  
- **API 映射**：  
  - `collectGeometry` → `bpy.data.objects[...]` + `mesh.vertices` / `mesh.polygons`  
  - `collectMaterials` → `obj.material_slots`  
  - `collectLODs` → Blender 中需自定义 LOD 集合（可用 Collection 或自定义属性）  
  - `writeVisualFile` → Python `open(..., "w")` 写 JSON/XML  
- **风险**：  
  - Blender 没有原生 LOD 概念，需要团队定义规则  
  - 材质系统与 Max 不同，需要映射表  

---

## 测试清单
- 单对象导出（简单立方体）  
- 多材质对象导出  
- 含 LOD 的对象导出  
- 导出路径不存在 → 自动创建目录  
- 导出后 `.visual` 文件能被引擎正确加载  

---

## 风险与 TODO
- LOD 在 Blender 的实现方式需团队确认（Collection vs 自定义属性）  
- 材质兼容性（Max → Blender → BigWorld）需要额外映射表  
- `.visual` 文件格式是否为 XML/JSON/二进制，需要确认引擎版本  

---


---

# BigWorld_Export_Animation.mcr 深度报告

## 概述
- **模块职责**：  
  将 3ds Max 中的骨骼动画（骨骼层级、关键帧、采样率、帧范围）导出为 BigWorld 的 `.animation` 文件。  
- **上下文位置**：  
  属于导出类文件，通常与 `Export_Visual` 配合使用：Visual 提供模型，Animation 提供动作。

---

## 输入与前置条件
- **输入数据**：  
  - 用户在 Max 中选中的骨骼对象或绑定的蒙皮模型  
  - 动画帧范围（起始帧、结束帧）  
  - 采样率（fps 或关键帧间隔）  
  - 导出路径（用户指定或默认路径）  
- **前置条件**：  
  - Common 模块可用（路径、日志、文件写入工具）  
  - Validator 模块可用（校验动画数据完整性）  
  - 模型必须有骨骼绑定，且动画曲线存在  

---

## 导出的接口
- **函数**：
  - `exportAnimation()`：主导出入口  
  - `collectBones()`：收集骨骼层级与名称  
  - `collectKeyframes()`：采样关键帧数据（位置、旋转、缩放）  
  - `resampleAnimation()`：根据采样率重采样  
  - `writeAnimationFile()`：写出 `.animation` 文件  
  - `validateBeforeExport()`：调用 Validator 校验  
- **数据结构**：
  - `AnimationData`：包含 bones、keyframes、frame_range、fps、export_path  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `exportAnimation()`  
2. **收集数据**：调用 `collectBones`、`collectKeyframes`  
3. **重采样**：调用 `resampleAnimation`，确保关键帧间隔统一  
4. **校验**：调用 `validateBeforeExport`，检查骨骼一致性、帧范围合法性  
5. **写出文件**：调用 `writeAnimationFile`，生成 `.animation` 文件  
6. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **animation_schema.json**（建议字段）：  
  ```json
  {
    "type": "object",
    "properties": {
      "animation_name": { "type": "string" },
      "bones": { "type": "array", "items": { "type": "string" } },
      "keyframes": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "frame": { "type": "integer" },
            "bone": { "type": "string" },
            "position": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
            "rotation": { "type": "array", "items": { "type": "number" }, "minItems": 4, "maxItems": 4 },
            "scale": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 }
          },
          "required": ["frame","bone","position","rotation"]
        }
      },
      "frame_range": { "type": "array", "items": { "type": "integer" }, "minItems": 2, "maxItems": 2 },
      "fps": { "type": "integer" },
      "export_path": { "type": "string" }
    },
    "required": ["animation_name","bones","keyframes","frame_range","fps","export_path"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_AnimationExportTools`  
- **按钮**：  
  - `btnExportAnimation` → “Export Animation”  
  - `btnSetFrameRange` → 设置帧范围  
  - `spnFPS` → 设置采样率（fps）  
  - `chkResample` → 是否强制重采样  

---

## 校验与错误处理
- **常见错误**：  
  - 未选择骨骼 → 报错  
  - 帧范围非法（起始 ≥ 结束） → 报错  
  - 骨骼缺失或未绑定 → 报错  
  - 关键帧为空 → 报错  
- **错误码建议**：  
  - 2201：未选择骨骼  
  - 2202：帧范围错误  
  - 2203：骨骼未绑定  
  - 2204：关键帧缺失  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`export/animation_export.py`  
- **API 映射**：  
  - `collectBones` → `obj.pose.bones`  
  - `collectKeyframes` → `bpy.context.scene.frame_set()` + `bone.matrix`  
  - `resampleAnimation` → Python 循环采样  
  - `writeAnimationFile` → JSON/XML 写出  
- **风险**：  
  - Blender 的骨骼体系（Armature）与 Max 不同，需要映射表  
  - 四元数旋转与欧拉角的差异，需要统一为四元数  

---

## 测试清单
- 单骨骼动画导出  
- 多骨骼绑定动画导出  
- 帧范围超出场景范围 → 报错  
- 采样率过高/过低 → 检查重采样结果  
- 导出后 `.animation` 文件能被引擎正确加载  

---

## 风险与 TODO
- 骨骼命名规范（Max vs Blender vs BigWorld）需统一  
- 动画文件格式是否为 XML/JSON/二进制，需要确认引擎版本  
- 是否支持蒙皮权重导出（可能在 Visual 中处理）  

---


---

# BigWorld_Export_Animation.mcr 深度报告

## 概述
- **模块职责**：  
  将 3ds Max 中的骨骼动画（骨骼层级、关键帧、采样率、帧范围）导出为 BigWorld 的 `.animation` 文件。  
- **上下文位置**：  
  属于导出类文件，通常与 `Export_Visual` 配合使用：Visual 提供模型，Animation 提供动作。

---

## 输入与前置条件
- **输入数据**：  
  - 用户在 Max 中选中的骨骼对象或绑定的蒙皮模型  
  - 动画帧范围（起始帧、结束帧）  
  - 采样率（fps 或关键帧间隔）  
  - 导出路径（用户指定或默认路径）  
- **前置条件**：  
  - Common 模块可用（路径、日志、文件写入工具）  
  - Validator 模块可用（校验动画数据完整性）  
  - 模型必须有骨骼绑定，且动画曲线存在  

---

## 导出的接口
- **函数**：
  - `exportAnimation()`：主导出入口  
  - `collectBones()`：收集骨骼层级与名称  
  - `collectKeyframes()`：采样关键帧数据（位置、旋转、缩放）  
  - `resampleAnimation()`：根据采样率重采样  
  - `writeAnimationFile()`：写出 `.animation` 文件  
  - `validateBeforeExport()`：调用 Validator 校验  
- **数据结构**：
  - `AnimationData`：包含 bones、keyframes、frame_range、fps、export_path  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `exportAnimation()`  
2. **收集数据**：调用 `collectBones`、`collectKeyframes`  
3. **重采样**：调用 `resampleAnimation`，确保关键帧间隔统一  
4. **校验**：调用 `validateBeforeExport`，检查骨骼一致性、帧范围合法性  
5. **写出文件**：调用 `writeAnimationFile`，生成 `.animation` 文件  
6. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **animation_schema.json**（建议字段）：  
  ```json
  {
    "type": "object",
    "properties": {
      "animation_name": { "type": "string" },
      "bones": { "type": "array", "items": { "type": "string" } },
      "keyframes": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "frame": { "type": "integer" },
            "bone": { "type": "string" },
            "position": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
            "rotation": { "type": "array", "items": { "type": "number" }, "minItems": 4, "maxItems": 4 },
            "scale": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 }
          },
          "required": ["frame","bone","position","rotation"]
        }
      },
      "frame_range": { "type": "array", "items": { "type": "integer" }, "minItems": 2, "maxItems": 2 },
      "fps": { "type": "integer" },
      "export_path": { "type": "string" }
    },
    "required": ["animation_name","bones","keyframes","frame_range","fps","export_path"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_AnimationExportTools`  
- **按钮**：  
  - `btnExportAnimation` → “Export Animation”  
  - `btnSetFrameRange` → 设置帧范围  
  - `spnFPS` → 设置采样率（fps）  
  - `chkResample` → 是否强制重采样  

---

## 校验与错误处理
- **常见错误**：  
  - 未选择骨骼 → 报错  
  - 帧范围非法（起始 ≥ 结束） → 报错  
  - 骨骼缺失或未绑定 → 报错  
  - 关键帧为空 → 报错  
- **错误码建议**：  
  - 2201：未选择骨骼  
  - 2202：帧范围错误  
  - 2203：骨骼未绑定  
  - 2204：关键帧缺失  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`export/animation_export.py`  
- **API 映射**：  
  - `collectBones` → `obj.pose.bones`  
  - `collectKeyframes` → `bpy.context.scene.frame_set()` + `bone.matrix`  
  - `resampleAnimation` → Python 循环采样  
  - `writeAnimationFile` → JSON/XML 写出  
- **风险**：  
  - Blender 的骨骼体系（Armature）与 Max 不同，需要映射表  
  - 四元数旋转与欧拉角的差异，需要统一为四元数  

---

## 测试清单
- 单骨骼动画导出  
- 多骨骼绑定动画导出  
- 帧范围超出场景范围 → 报错  
- 采样率过高/过低 → 检查重采样结果  
- 导出后 `.animation` 文件能被引擎正确加载  

---

## 风险与 TODO
- 骨骼命名规范（Max vs Blender vs BigWorld）需统一  
- 动画文件格式是否为 XML/JSON/二进制，需要确认引擎版本  
- 是否支持蒙皮权重导出（可能在 Visual 中处理）  

---


---

# BigWorld_Define_Hitboxes.mcr 深度报告

## 概述
- **模块职责**：  
  在 3ds Max 场景中定义 HitBox（碰撞盒），通常与骨骼绑定，用于物理模拟、碰撞检测和受击判定。  
- **上下文位置**：  
  与 `Export_HitBox_to_xml.mcr` 配合使用：本模块负责创建与编辑，后者负责导出。

---

## 输入与前置条件
- **输入数据**：  
  - 用户在 Max 中选择的骨骼或模型节点  
  - 用户指定的 HitBox 名称、尺寸、位置、旋转、类型（box/sphere/capsule）  
- **前置条件**：  
  - Common 模块可用（路径、日志、工具函数）  
  - Validator 模块可用（校验 HitBox 定义合法性）  
  - 场景中存在可绑定的骨骼或对象  

---

## 导出的接口
- **函数**：
  - `createHitBox()`：创建新的 HitBox 节点  
  - `attachHitBoxToBone(bone)`：将 HitBox 绑定到骨骼  
  - `updateHitBoxProperties()`：修改尺寸、位置、旋转  
  - `deleteHitBox()`：删除选中的 HitBox  
  - `listHitBoxes()`：列出当前场景所有 HitBox  
  - `validateHitBox()`：调用 Validator 校验  
- **数据结构**：
  - `HitBoxDefinition`：包含 name、bone、dimensions、position、rotation、type  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `createHitBox()`  
2. **绑定骨骼**：调用 `attachHitBoxToBone`  
3. **设置属性**：通过 UI 输入或修改 → `updateHitBoxProperties`  
4. **校验**：调用 `validateHitBox`，检查合法性  
5. **保存定义**：存储在场景自定义属性或临时集合中  
6. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **hitbox_schema.json**（建议字段）：  
  ```json
  {
    "type": "object",
    "properties": {
      "hitbox_name": { "type": "string" },
      "bone": { "type": "string" },
      "dimensions": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
      "position": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
      "rotation": { "type": "array", "items": { "type": "number" }, "minItems": 4, "maxItems": 4 },
      "type": { "type": "string", "enum": ["box","sphere","capsule"] }
    },
    "required": ["hitbox_name","bone","dimensions","position","rotation","type"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_HitBoxTools`  
- **按钮**：  
  - `btnCreateHitBox` → “Create HitBox”  
  - `btnAttachBone` → 绑定骨骼  
  - `btnUpdateHitBox` → 更新属性  
  - `btnDeleteHitBox` → 删除  
  - `btnListHitBoxes` → 列出所有  

---

## 校验与错误处理
- **常见错误**：  
  - 未选择骨骼 → 报错  
  - HitBox 名称重复 → 报错  
  - 尺寸非法（零或负数） → 报错  
  - 类型不支持 → 报错  
- **错误码建议**：  
  - 2401：未选择骨骼  
  - 2402：名称重复  
  - 2403：尺寸非法  
  - 2404：类型错误  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`tools/hitbox_define.py`  
- **API 映射**：  
  - `createHitBox` → 在 Blender 中创建 Empty 或 Mesh Cube/Sphere，附加自定义属性  
  - `attachHitBoxToBone` → 将 Empty 设为 Bone 的子对象（Armature parenting）  
  - `updateHitBoxProperties` → 修改 Empty 的 scale/rotation/location  
  - `listHitBoxes` → 遍历场景中带有 `hitbox_type` 属性的对象  
- **风险**：  
  - Blender 没有原生 HitBox 概念，需要团队统一规范（推荐 Empty + 自定义属性）  
  - 骨骼绑定方式（Parent vs Constraint）需确认  

---

## 测试清单
- 创建单个 HitBox 并绑定骨骼  
- 创建多个 HitBox，检查名称唯一性  
- 修改尺寸/位置/旋转 → 正确更新  
- 删除 HitBox → 场景中消失  
- 列出所有 HitBox → 输出完整列表  
- 非法输入（尺寸为 0、无骨骼） → 报错  

---

## 风险与 TODO
- HitBox 在 Blender 中的表示方式需团队最终确认（Empty vs Mesh）  
- 骨骼命名一致性（Max vs Blender vs BigWorld）需统一  
- 是否需要支持批量创建/批量修改功能  

---


---

# BigWorld_Exit_Portal.mcr 深度报告

## 概述
- **模块职责**：  
  在场景中创建并管理 **Exit Portal**，用于定义场景出口区域，通常与引擎的空间划分和可见性系统配合使用。  
- **上下文位置**：  
  Portal 系列的第一个模块，后续还有 Heaven、Standard、Label Portal。  

---

## 输入与前置条件
- **输入数据**：  
  - 用户在 Max 中选择的位置（通常是一个平面或矩形区域）  
  - Portal 名称  
  - 法线方向（决定 Portal 的朝向）  
  - 宽度、高度（定义 Portal 的尺寸）  
- **前置条件**：  
  - Common 模块可用（路径、日志、工具函数）  
  - Validator 模块可用（校验 Portal 定义合法性）  
  - 场景中存在可放置 Portal 的几何或参考点  

---

## 导出的接口
- **函数**：
  - `createExitPortal()`：创建新的 Exit Portal  
  - `setPortalProperties()`：设置名称、尺寸、法线  
  - `attachPortalToScene()`：将 Portal 节点加入场景  
  - `deleteExitPortal()`：删除 Portal  
  - `listExitPortals()`：列出所有 Exit Portal  
  - `validateExitPortal()`：调用 Validator 校验  
- **数据结构**：
  - `PortalData`：包含 name、position、normal、width、height、type=exit  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `createExitPortal()`  
2. **设置属性**：调用 `setPortalProperties`（名称、法线、尺寸）  
3. **绑定场景**：调用 `attachPortalToScene`  
4. **校验**：调用 `validateExitPortal`，检查法线合法性、尺寸合理性  
5. **保存定义**：存储在场景自定义属性或集合中  
6. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **portal_schema.json**（Exit Portal 部分）：  
  ```json
  {
    "type": "object",
    "properties": {
      "portal_name": { "type": "string" },
      "type": { "type": "string", "enum": ["exit"] },
      "position": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
      "normal": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
      "width": { "type": "number" },
      "height": { "type": "number" }
    },
    "required": ["portal_name","type","position","normal","width","height"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_ExitPortalTools`  
- **按钮**：  
  - `btnCreateExitPortal` → “Create Exit Portal”  
  - `btnUpdateExitPortal` → 更新属性  
  - `btnDeleteExitPortal` → 删除  
  - `btnListExitPortals` → 列出所有  

---

## 校验与错误处理
- **常见错误**：  
  - 未指定法线 → 报错  
  - 尺寸非法（零或负数） → 报错  
  - 名称重复 → 报错  
- **错误码建议**：  
  - 2501：未指定法线  
  - 2502：尺寸非法  
  - 2503：名称重复  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`portal/exit_portal.py`  
- **API 映射**：  
  - `createExitPortal` → 在 Blender 中创建 Empty 或 Plane，附加自定义属性 `portal_type="exit"`  
  - `setPortalProperties` → 设置对象的 location、scale、custom properties  
  - `listExitPortals` → 遍历场景中带有 `portal_type="exit"` 的对象  
- **风险**：  
  - Blender 没有原生 Portal 概念，需要团队统一规范（推荐 Empty + 自定义属性）  
  - 法线方向需通过对象的局部 Z 轴或自定义属性表示  

---

## 测试清单
- 创建单个 Exit Portal → 正确显示  
- 修改尺寸/法线 → 正确更新  
- 删除 Portal → 场景中消失  
- 列出所有 Portal → 输出完整列表  
- 非法输入（法线为零向量、尺寸为 0） → 报错  

---

## 风险与 TODO
- Portal 在 Blender 中的表示方式需团队最终确认（Empty vs Plane）  
- 法线方向的定义方式需统一（局部坐标 vs 自定义属性）  
- 与其他 Portal 类型（Heaven、Standard、Label）的字段一致性需保持  

---


---

# BigWorld_Heaven_Portal.mcr 深度报告

## 概述
- **模块职责**：  
  在场景中创建并管理 **Heaven Portal**，用于定义天空或无限远背景的可见性入口，通常与引擎的天空盒、全局光照或特殊渲染层配合使用。  
- **上下文位置**：  
  Portal 系列的第二个模块，和 Exit/Standard/Label Portal 一起构成完整的空间划分工具链。  

---

## 输入与前置条件
- **输入数据**：  
  - 用户在 Max 中选择的位置（通常是一个矩形或平面区域）  
  - Portal 名称  
  - 法线方向（决定 Portal 的朝向）  
  - 宽度、高度（定义 Portal 的尺寸）  
- **前置条件**：  
  - Common 模块可用（路径、日志、工具函数）  
  - Validator 模块可用（校验 Portal 定义合法性）  
  - 场景中存在可放置 Portal 的几何或参考点  

---

## 导出的接口
- **函数**：
  - `createHeavenPortal()`：创建新的 Heaven Portal  
  - `setPortalProperties()`：设置名称、尺寸、法线  
  - `attachPortalToScene()`：将 Portal 节点加入场景  
  - `deleteHeavenPortal()`：删除 Portal  
  - `listHeavenPortals()`：列出所有 Heaven Portal  
  - `validateHeavenPortal()`：调用 Validator 校验  
- **数据结构**：
  - `PortalData`：包含 name、position、normal、width、height、type=heaven  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `createHeavenPortal()`  
2. **设置属性**：调用 `setPortalProperties`（名称、法线、尺寸）  
3. **绑定场景**：调用 `attachPortalToScene`  
4. **校验**：调用 `validateHeavenPortal`，检查法线合法性、尺寸合理性  
5. **保存定义**：存储在场景自定义属性或集合中  
6. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **portal_schema.json**（Heaven Portal 部分）：  
  ```json
  {
    "type": "object",
    "properties": {
      "portal_name": { "type": "string" },
      "type": { "type": "string", "enum": ["heaven"] },
      "position": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
      "normal": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
      "width": { "type": "number" },
      "height": { "type": "number" }
    },
    "required": ["portal_name","type","position","normal","width","height"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_HeavenPortalTools`  
- **按钮**：  
  - `btnCreateHeavenPortal` → “Create Heaven Portal”  
  - `btnUpdateHeavenPortal` → 更新属性  
  - `btnDeleteHeavenPortal` → 删除  
  - `btnListHeavenPortals` → 列出所有  

---

## 校验与错误处理
- **常见错误**：  
  - 未指定法线 → 报错  
  - 尺寸非法（零或负数） → 报错  
  - 名称重复 → 报错  
- **错误码建议**：  
  - 2601：未指定法线  
  - 2602：尺寸非法  
  - 2603：名称重复  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`portal/heaven_portal.py`  
- **API 映射**：  
  - `createHeavenPortal` → 在 Blender 中创建 Empty 或 Plane，附加自定义属性 `portal_type="heaven"`  
  - `setPortalProperties` → 设置对象的 location、scale、custom properties  
  - `listHeavenPortals` → 遍历场景中带有 `portal_type="heaven"` 的对象  
- **风险**：  
  - Blender 没有原生 Heaven Portal 概念，需要团队统一规范（推荐 Empty + 自定义属性）  
  - Heaven Portal 的渲染语义（天空盒/全局光照）需与引擎对齐  

---

## 测试清单
- 创建单个 Heaven Portal → 正确显示  
- 修改尺寸/法线 → 正确更新  
- 删除 Portal → 场景中消失  
- 列出所有 Portal → 输出完整列表  
- 非法输入（法线为零向量、尺寸为 0） → 报错  

---

## 风险与 TODO
- Heaven Portal 在 Blender 中的语义需团队确认（是否直接映射为天空盒入口）  
- 法线方向的定义方式需统一（局部坐标 vs 自定义属性）  
- 与其他 Portal 类型的字段一致性需保持  

---


---

# BigWorld_Standard_Portal.mcr 深度报告

## 概述
- **模块职责**：  
  在场景中创建并管理 **Standard Portal**，用于定义普通的空间连接区域，通常用于室内外空间切换、可见性裁剪和性能优化。  
- **上下文位置**：  
  Portal 系列的第三个模块，和 Exit/Heaven/Label Portal 一起构成完整的空间划分工具链。  

---

## 输入与前置条件
- **输入数据**：  
  - 用户在 Max 中选择的位置（通常是一个矩形或平面区域）  
  - Portal 名称  
  - 法线方向（决定 Portal 的朝向）  
  - 宽度、高度（定义 Portal 的尺寸）  
- **前置条件**：  
  - Common 模块可用（路径、日志、工具函数）  
  - Validator 模块可用（校验 Portal 定义合法性）  
  - 场景中存在可放置 Portal 的几何或参考点  

---

## 导出的接口
- **函数**：
  - `createStandardPortal()`：创建新的 Standard Portal  
  - `setPortalProperties()`：设置名称、尺寸、法线  
  - `attachPortalToScene()`：将 Portal 节点加入场景  
  - `deleteStandardPortal()`：删除 Portal  
  - `listStandardPortals()`：列出所有 Standard Portal  
  - `validateStandardPortal()`：调用 Validator 校验  
- **数据结构**：
  - `PortalData`：包含 name、position、normal、width、height、type=standard  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `createStandardPortal()`  
2. **设置属性**：调用 `setPortalProperties`（名称、法线、尺寸）  
3. **绑定场景**：调用 `attachPortalToScene`  
4. **校验**：调用 `validateStandardPortal`，检查法线合法性、尺寸合理性  
5. **保存定义**：存储在场景自定义属性或集合中  
6. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **portal_schema.json**（Standard Portal 部分）：  
  ```json
  {
    "type": "object",
    "properties": {
      "portal_name": { "type": "string" },
      "type": { "type": "string", "enum": ["standard"] },
      "position": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
      "normal": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
      "width": { "type": "number" },
      "height": { "type": "number" }
    },
    "required": ["portal_name","type","position","normal","width","height"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_StandardPortalTools`  
- **按钮**：  
  - `btnCreateStandardPortal` → “Create Standard Portal”  
  - `btnUpdateStandardPortal` → 更新属性  
  - `btnDeleteStandardPortal` → 删除  
  - `btnListStandardPortals` → 列出所有  

---

## 校验与错误处理
- **常见错误**：  
  - 未指定法线 → 报错  
  - 尺寸非法（零或负数） → 报错  
  - 名称重复 → 报错  
- **错误码建议**：  
  - 2701：未指定法线  
  - 2702：尺寸非法  
  - 2703：名称重复  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`portal/standard_portal.py`  
- **API 映射**：  
  - `createStandardPortal` → 在 Blender 中创建 Empty 或 Plane，附加自定义属性 `portal_type="standard"`  
  - `setPortalProperties` → 设置对象的 location、scale、custom properties  
  - `listStandardPortals` → 遍历场景中带有 `portal_type="standard"` 的对象  
- **风险**：  
  - Blender 没有原生 Portal 概念，需要团队统一规范（推荐 Empty + 自定义属性）  
  - 法线方向需通过对象的局部 Z 轴或自定义属性表示  

---

## 测试清单
- 创建单个 Standard Portal → 正确显示  
- 修改尺寸/法线 → 正确更新  
- 删除 Portal → 场景中消失  
- 列出所有 Portal → 输出完整列表  
- 非法输入（法线为零向量、尺寸为 0） → 报错  

---

## 风险与 TODO
- Standard Portal 在 Blender 中的表示方式需团队最终确认（Empty vs Plane）  
- 法线方向的定义方式需统一（局部坐标 vs 自定义属性）  
- 与其他 Portal 类型的字段一致性需保持  

---


---

# BigWorld_Label_Portal.mcr 深度报告

## 概述
- **模块职责**：  
  在场景中创建并管理 **Label Portal**，与其他 Portal（Exit、Heaven、Standard）不同，它主要用于标记和逻辑分区，例如给 Portal 添加语义标签（如“室内入口”、“任务区域”）。  
- **上下文位置**：  
  Portal 系列的最后一个模块，通常与其他 Portal 配合使用，用于增强可见性裁剪和逻辑控制。

---

## 输入与前置条件
- **输入数据**：  
  - 用户在 Max 中选择的位置（通常是一个矩形或平面区域）  
  - Portal 名称  
  - 法线方向（决定 Portal 的朝向）  
  - 宽度、高度（定义 Portal 的尺寸）  
  - 标签（字符串，用于逻辑标记）  
- **前置条件**：  
  - Common 模块可用（路径、日志、工具函数）  
  - Validator 模块可用（校验 Portal 定义合法性）  
  - 场景中存在可放置 Portal 的几何或参考点  

---

## 导出的接口
- **函数**：
  - `createLabelPortal()`：创建新的 Label Portal  
  - `setPortalProperties()`：设置名称、尺寸、法线、标签  
  - `attachPortalToScene()`：将 Portal 节点加入场景  
  - `deleteLabelPortal()`：删除 Portal  
  - `listLabelPortals()`：列出所有 Label Portal  
  - `validateLabelPortal()`：调用 Validator 校验  
- **数据结构**：
  - `PortalData`：包含 name、position、normal、width、height、label、type=label  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `createLabelPortal()`  
2. **设置属性**：调用 `setPortalProperties`（名称、法线、尺寸、标签）  
3. **绑定场景**：调用 `attachPortalToScene`  
4. **校验**：调用 `validateLabelPortal`，检查法线合法性、尺寸合理性、标签唯一性  
5. **保存定义**：存储在场景自定义属性或集合中  
6. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **portal_schema.json**（Label Portal 部分）：  
  ```json
  {
    "type": "object",
    "properties": {
      "portal_name": { "type": "string" },
      "type": { "type": "string", "enum": ["label"] },
      "position": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
      "normal": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
      "width": { "type": "number" },
      "height": { "type": "number" },
      "label": { "type": "string" }
    },
    "required": ["portal_name","type","position","normal","width","height","label"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_LabelPortalTools`  
- **按钮**：  
  - `btnCreateLabelPortal` → “Create Label Portal”  
  - `btnUpdateLabelPortal` → 更新属性  
  - `btnDeleteLabelPortal` → 删除  
  - `btnListLabelPortals` → 列出所有  

---

## 校验与错误处理
- **常见错误**：  
  - 未指定法线 → 报错  
  - 尺寸非法（零或负数） → 报错  
  - 名称重复 → 报错  
  - 标签为空或重复 → 报错  
- **错误码建议**：  
  - 2801：未指定法线  
  - 2802：尺寸非法  
  - 2803：名称重复  
  - 2804：标签错误  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`portal/label_portal.py`  
- **API 映射**：  
  - `createLabelPortal` → 在 Blender 中创建 Empty 或 Plane，附加自定义属性 `portal_type="label"` 和 `portal_label="xxx"`  
  - `setPortalProperties` → 设置对象的 location、scale、custom properties  
  - `listLabelPortals` → 遍历场景中带有 `portal_type="label"` 的对象  
- **风险**：  
  - Blender 没有原生 Label Portal 概念，需要团队统一规范（推荐 Empty + 自定义属性）  
  - 标签的唯一性需在插件层面强制校验  

---

## 测试清单
- 创建单个 Label Portal → 正确显示  
- 修改尺寸/法线/标签 → 正确更新  
- 删除 Portal → 场景中消失  
- 列出所有 Portal → 输出完整列表  
- 非法输入（法线为零向量、尺寸为 0、标签为空） → 报错  

---

## 风险与 TODO
- Label Portal 的标签语义需团队确认（是逻辑标记还是渲染标记）  
- 标签唯一性策略需明确（全局唯一 vs 同类型唯一）  
- 与其他 Portal 类型的字段一致性需保持  

---


---

# BigWorld_Import_HardPoint.mcr 深度报告

## 概述
- **模块职责**：  
  从外部文件（通常是 `.hardpoint` 或 `.xml`）中读取 HardPoint 定义，并在 3ds Max 场景中创建对应的节点，绑定到骨骼或模型上。  
- **上下文位置**：  
  属于导入类工具，常与导出 Visual/Animation 配合使用，用于保证模型在引擎中有正确的挂点。

---

## 输入与前置条件
- **输入数据**：  
  - 外部 HardPoint 文件（包含名称、类型、位置、方向、缩放等信息）  
  - 用户在 Max 中选择的目标对象（通常是骨骼或模型）  
- **前置条件**：  
  - Common 模块可用（路径、日志、文件读取工具）  
  - Validator 模块可用（校验 HardPoint 数据合法性）  
  - 文件路径有效且可读取  

---

## 导出的接口
- **函数**：
  - `importHardPoint()`：主导入入口  
  - `parseHardPointFile()`：解析外部文件，提取 HardPoint 数据  
  - `createHardPointNode()`：在场景中创建 HardPoint 节点  
  - `attachHardPointToBone(bone)`：将 HardPoint 绑定到骨骼  
  - `validateHardPoint()`：调用 Validator 校验  
- **数据结构**：
  - `HardPointData`：包含 name、type、position、rotation、scale、parent_bone  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `importHardPoint()`  
2. **解析文件**：调用 `parseHardPointFile`，读取 HardPoint 数据  
3. **创建节点**：调用 `createHardPointNode`，在场景中生成对应对象  
4. **绑定骨骼**：调用 `attachHardPointToBone`  
5. **校验**：调用 `validateHardPoint`，检查数据合法性  
6. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **hardpoint_schema.json**（建议字段）：  
  ```json
  {
    "type": "object",
    "properties": {
      "hardpoint_name": { "type": "string" },
      "type": { "type": "string", "enum": ["weapon","fx","camera","custom"] },
      "position": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
      "rotation": { "type": "array", "items": { "type": "number" }, "minItems": 4, "maxItems": 4 },
      "scale": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
      "parent_bone": { "type": "string" }
    },
    "required": ["hardpoint_name","type","position","rotation","parent_bone"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_HardPointImportTools`  
- **按钮**：  
  - `btnImportHardPoint` → “Import HardPoint”  
  - `btnSelectFile` → 选择文件  
  - `btnAttachBone` → 绑定骨骼  
  - `btnListHardPoints` → 列出所有导入的 HardPoint  

---

## 校验与错误处理
- **常见错误**：  
  - 文件不存在或无法读取 → 报错  
  - 文件格式错误 → 报错  
  - 骨骼不存在 → 报错  
  - HardPoint 名称重复 → 报错  
- **错误码建议**：  
  - 2901：文件不存在  
  - 2902：文件格式错误  
  - 2903：骨骼不存在  
  - 2904：名称重复  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`import/hardpoint_import.py`  
- **API 映射**：  
  - `parseHardPointFile` → Python `xml.etree.ElementTree` 或 `json`  
  - `createHardPointNode` → Blender 中创建 Empty，附加自定义属性  
  - `attachHardPointToBone` → 将 Empty 设为 Armature 的子对象（Parent to Bone）  
  - `listHardPoints` → 遍历场景中带有 `hardpoint_type` 属性的对象  
- **风险**：  
  - Blender 与 Max 的骨骼体系不同，需要映射表  
  - HardPoint 类型（weapon/fx/camera/custom）需团队统一规范  

---

## 测试清单
- 导入单个 HardPoint 文件 → 正确生成节点  
- 导入多个 HardPoint → 正确绑定骨骼  
- 文件格式错误 → 报错  
- 骨骼不存在 → 报错  
- 名称重复 → 报错  
- 导入后 HardPoint 节点能被引擎正确识别  

---

## 风险与 TODO
- HardPoint 文件格式（XML/JSON）需确认引擎版本  
- 骨骼命名一致性（Max vs Blender vs BigWorld）需统一  
- 是否需要支持批量导入多个文件  

---


---

# BigWorld_Make_BSP.mcr 深度报告

## 概述
- **模块职责**：  
  将 3ds Max 中的几何体转换为 BSP 数据结构，导出为 BigWorld 引擎可识别的 `.bsp` 文件。  
- **上下文位置**：  
  几何处理类的核心模块之一，通常与 Hull、Normals、Divider 配合使用，用于场景优化和物理计算。  

---

## 输入与前置条件
- **输入数据**：  
  - 用户在 Max 中选择的几何体（Mesh/Poly）  
  - BSP 深度（递归划分层数）  
  - 容差（划分精度阈值）  
  - 优化选项（是否合并共面、是否移除冗余节点）  
  - 导出路径  
- **前置条件**：  
  - Common 模块可用（路径、日志、文件写入工具）  
  - Validator 模块可用（校验几何合法性）  
  - 几何体必须是封闭体或可划分的网格  

---

## 导出的接口
- **函数**：
  - `makeBSP()`：主生成入口  
  - `collectGeometry()`：收集几何体顶点、面数据  
  - `buildBSPTree()`：递归构建 BSP 树  
  - `optimizeBSPTree()`：优化树结构（合并、裁剪）  
  - `writeBSPFile()`：写出 `.bsp` 文件  
  - `validateBeforeExport()`：调用 Validator 校验  
- **数据结构**：
  - `BSPNode`：包含 plane、front、back、polygons  
  - `BSPTree`：根节点 + 节点集合  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `makeBSP()`  
2. **收集几何体**：调用 `collectGeometry`  
3. **构建树**：调用 `buildBSPTree`，递归划分空间  
4. **优化**：调用 `optimizeBSPTree`，减少冗余节点  
5. **校验**：调用 `validateBeforeExport`，检查树结构合法性  
6. **写出文件**：调用 `writeBSPFile`，生成 `.bsp` 文件  
7. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **bsp_schema.json**（建议字段）：  
  ```json
  {
    "type": "object",
    "properties": {
      "bsp_name": { "type": "string" },
      "nodes": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "plane": { "type": "array", "items": { "type": "number" }, "minItems": 4, "maxItems": 4 },
            "front": { "type": ["integer","null"] },
            "back": { "type": ["integer","null"] },
            "polygons": { "type": "array", "items": { "type": "integer" } }
          },
          "required": ["plane","polygons"]
        }
      },
      "export_path": { "type": "string" }
    },
    "required": ["bsp_name","nodes","export_path"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_BSPTools`  
- **按钮**：  
  - `btnMakeBSP` → “Make BSP”  
  - `spnDepth` → 设置 BSP 深度  
  - `spnTolerance` → 设置容差  
  - `chkOptimize` → 是否优化  

---

## 校验与错误处理
- **常见错误**：  
  - 未选择几何体 → 报错  
  - 几何体非封闭 → 报错  
  - 深度过大 → 警告（性能问题）  
  - 导出路径无效 → 报错  
- **错误码建议**：  
  - 3001：未选择几何体  
  - 3002：几何体非封闭  
  - 3003：深度过大  
  - 3004：路径错误  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`geometry/make_bsp.py`  
- **API 映射**：  
  - `collectGeometry` → `bpy.data.objects[...]` + `mesh.vertices` / `mesh.polygons`  
  - `buildBSPTree` → Python 递归实现 BSP 算法  
  - `optimizeBSPTree` → 合并共面、移除冗余节点  
  - `writeBSPFile` → JSON/XML 写出  
- **风险**：  
  - Blender 没有内置 BSP，需要自研算法  
  - 大场景性能问题，需要优化  

---

## 测试清单
- 简单立方体生成 BSP → 正确  
- 非封闭几何 → 报错  
- 深度过大 → 警告  
- 优化开关 → 节点数量减少  
- 导出后 `.bsp` 文件能被引擎正确加载  

---

## 风险与 TODO
- BSP 算法实现需团队确认（平面选择策略、划分规则）  
- 导出文件格式（XML/JSON/二进制）需确认引擎版本  
- 大规模场景的性能优化需额外设计  

---


---

# BigWorld_Make_CustomHull.mcr 深度报告

## 概述
- **模块职责**：  
  将 3ds Max 中的几何体转换为 **自定义 Hull（凸包/凹壳）**，用于物理引擎的碰撞检测。与 BSP 不同，Hull 更适合物理模拟（如角色、载具、道具的碰撞体）。  
- **上下文位置**：  
  几何处理类的第二个模块，通常与 BSP、Normals、Divider 配合使用。  

---

## 输入与前置条件
- **输入数据**：  
  - 用户在 Max 中选择的几何体  
  - Hull 类型（Convex/Concave）  
  - 分辨率（采样精度）  
  - 容差（几何简化阈值）  
  - 优化选项（是否合并、是否简化）  
  - 导出路径  
- **前置条件**：  
  - Common 模块可用（路径、日志、文件写入工具）  
  - Validator 模块可用（校验几何合法性）  
  - 几何体必须是可生成 Hull 的网格  

---

## 导出的接口
- **函数**：
  - `makeCustomHull()`：主生成入口  
  - `collectGeometry()`：收集几何体顶点、面数据  
  - `generateConvexHull()`：生成凸包  
  - `generateConcaveHull()`：生成凹壳（通常基于分解算法）  
  - `optimizeHull()`：优化 Hull（减少多边形数量）  
  - `writeHullFile()`：写出 `.hull` 文件  
  - `validateBeforeExport()`：调用 Validator 校验  
- **数据结构**：
  - `HullData`：包含 hull_type、vertices、faces、tolerance、resolution、export_path  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `makeCustomHull()`  
2. **收集几何体**：调用 `collectGeometry`  
3. **生成 Hull**：根据类型调用 `generateConvexHull` 或 `generateConcaveHull`  
4. **优化**：调用 `optimizeHull`，减少冗余面  
5. **校验**：调用 `validateBeforeExport`，检查 Hull 合法性  
6. **写出文件**：调用 `writeHullFile`，生成 `.hull` 文件  
7. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **hull_schema.json**（建议字段）：  
  ```json
  {
    "type": "object",
    "properties": {
      "hull_name": { "type": "string" },
      "hull_type": { "type": "string", "enum": ["convex","concave"] },
      "vertices": {
        "type": "array",
        "items": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 }
      },
      "faces": {
        "type": "array",
        "items": { "type": "array", "items": { "type": "integer" } }
      },
      "tolerance": { "type": "number" },
      "resolution": { "type": "integer" },
      "export_path": { "type": "string" }
    },
    "required": ["hull_name","hull_type","vertices","faces","export_path"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_HullTools`  
- **按钮**：  
  - `btnMakeHull` → “Make Custom Hull”  
  - `ddlHullType` → 选择 Hull 类型（Convex/Concave）  
  - `spnResolution` → 设置分辨率  
  - `spnTolerance` → 设置容差  
  - `chkOptimize` → 是否优化  

---

## 校验与错误处理
- **常见错误**：  
  - 未选择几何体 → 报错  
  - 几何体过于复杂 → 警告  
  - 容差/分辨率非法 → 报错  
  - 导出路径无效 → 报错  
- **错误码建议**：  
  - 3101：未选择几何体  
  - 3102：几何体过于复杂  
  - 3103：参数非法  
  - 3104：路径错误  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`geometry/make_hull.py`  
- **API 映射**：  
  - `collectGeometry` → `bpy.data.objects[...]` + `mesh.vertices` / `mesh.polygons`  
  - `generateConvexHull` → Blender 内置 `bpy.ops.mesh.convex_hull()`  
  - `generateConcaveHull` → 需自研算法或调用外部库（如 VHACD）  
  - `optimizeHull` → Blender 的 Decimate Modifier 或自定义简化算法  
  - `writeHullFile` → JSON/XML 写出  
- **风险**：  
  - Concave Hull 生成复杂，可能需要外部库支持  
  - 大规模几何体性能问题  

---

## 测试清单
- 简单立方体生成 Convex Hull → 正确  
- 复杂几何体生成 Concave Hull → 正确  
- 容差/分辨率参数调整 → Hull 精度变化  
- 优化开关 → 面数减少  
- 导出后 `.hull` 文件能被引擎正确加载  

---

## 风险与 TODO
- Concave Hull 算法实现需团队确认（是否使用 VHACD）  
- 导出文件格式（XML/JSON/二进制）需确认引擎版本  
- 大规模场景的性能优化需额外设计  

---


---

# BigWorld_Munge_Normals.mcr 深度报告

## 概述
- **模块职责**：  
  对 3ds Max 中的几何体法线进行统一、重算、平滑或硬化处理，确保导出的模型在 BigWorld 引擎中渲染正确。  
- **上下文位置**：  
  几何处理类的第三个模块，通常在导出 Visual 前使用，以保证法线数据的正确性。  

---

## 输入与前置条件
- **输入数据**：  
  - 用户在 Max 中选择的几何体  
  - 法线处理模式（重算、统一、平滑、硬边）  
  - 平滑角度阈值（决定哪些边界被视为硬边）  
- **前置条件**：  
  - Common 模块可用（日志、工具函数）  
  - Validator 模块可用（校验几何合法性）  
  - 几何体必须有可编辑的法线数据  

---

## 导出的接口
- **函数**：
  - `mungeNormals()`：主处理入口  
  - `recalculateNormals()`：重算所有法线  
  - `unifyNormals()`：统一法线方向（避免翻转）  
  - `smoothNormals(angle)`：按角度阈值平滑  
  - `hardenNormals(angle)`：按角度阈值硬化  
  - `validateNormals()`：调用 Validator 校验  
- **数据结构**：
  - `NormalData`：包含 vertex_normals、face_normals、smoothing_groups  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `mungeNormals()`  
2. **选择模式**：根据用户选择调用 `recalculateNormals`、`unifyNormals`、`smoothNormals` 或 `hardenNormals`  
3. **校验**：调用 `validateNormals`，检查法线方向一致性  
4. **更新几何体**：将处理后的法线写回模型  
5. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **normals_schema.json**（建议字段）：  
  ```json
  {
    "type": "object",
    "properties": {
      "object_name": { "type": "string" },
      "mode": { "type": "string", "enum": ["recalculate","unify","smooth","harden"] },
      "angle_threshold": { "type": "number" },
      "vertex_normals": {
        "type": "array",
        "items": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 }
      },
      "face_normals": {
        "type": "array",
        "items": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 }
      }
    },
    "required": ["object_name","mode","vertex_normals","face_normals"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_NormalTools`  
- **按钮**：  
  - `btnRecalculateNormals` → “Recalculate Normals”  
  - `btnUnifyNormals` → “Unify Normals”  
  - `btnSmoothNormals` → “Smooth Normals”  
  - `btnHardenNormals` → “Harden Normals”  
  - `spnAngleThreshold` → 设置角度阈值  

---

## 校验与错误处理
- **常见错误**：  
  - 未选择几何体 → 报错  
  - 法线数据缺失 → 报错  
  - 阈值非法（负数或过大） → 报错  
- **错误码建议**：  
  - 3201：未选择几何体  
  - 3202：法线数据缺失  
  - 3203：阈值非法  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`geometry/munge_normals.py`  
- **API 映射**：  
  - `recalculateNormals` → `bpy.ops.mesh.normals_make_consistent()`  
  - `unifyNormals` → Blender 内置 unify normals 功能  
  - `smoothNormals(angle)` → `bpy.ops.mesh.faces_shade_smooth()` + `obj.data.use_auto_smooth=True` + `obj.data.auto_smooth_angle`  
  - `hardenNormals(angle)` → `bpy.ops.mesh.faces_shade_flat()` 或自定义分组  
- **风险**：  
  - Blender 的法线系统与 Max 不完全一致，需要额外测试  
  - 平滑组（Smoothing Groups）在 Blender 中需要用 Auto Smooth 模拟  

---

## 测试清单
- 简单立方体 → 重算法线  
- 球体 → 平滑法线（角度阈值 30°/60°/90°）  
- 模型带翻转法线 → 统一修正  
- 模型带硬边 → 硬化处理  
- 导出后 Visual 文件在引擎中渲染正确  

---

## 风险与 TODO
- 平滑组与 Blender Auto Smooth 的映射需团队确认  
- 是否需要支持逐面法线编辑（Blender 支持，但 Max 脚本可能没有）  
- 导出时是否需要写入独立的法线文件，需确认引擎版本  

---


---

# BigWorld_Object_Divider.mcr 深度报告

## 概述
- **模块职责**：  
  将 3ds Max 中的复杂几何体按规则拆分为多个子对象，避免单个对象过大导致引擎性能下降或无法加载。  
- **上下文位置**：  
  几何处理类的最后一个模块，通常在导出 Visual 前使用，保证对象规模符合 BigWorld 引擎要求。  

---

## 输入与前置条件
- **输入数据**：  
  - 用户在 Max 中选择的几何体  
  - 最大顶点数（如 65535）  
  - 最大面数（如 65535）  
  - 是否保留层级结构  
  - 命名规则（子对象命名方式）  
- **前置条件**：  
  - Common 模块可用（日志、工具函数）  
  - Validator 模块可用（校验几何合法性）  
  - 几何体必须是可编辑网格  

---

## 导出的接口
- **函数**：
  - `divideObject()`：主拆分入口  
  - `collectGeometry()`：收集几何体数据  
  - `splitByVertexLimit(limit)`：按顶点数拆分  
  - `splitByFaceLimit(limit)`：按面数拆分  
  - `applyNamingRule()`：对子对象命名  
  - `validateDividedObjects()`：调用 Validator 校验  
- **数据结构**：
  - `DividedObjectData`：包含 original_name、sub_objects、vertex_count、face_count、naming_rule  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `divideObject()`  
2. **收集几何体**：调用 `collectGeometry`  
3. **判断限制**：检查顶点/面数是否超限  
4. **拆分**：调用 `splitByVertexLimit` 或 `splitByFaceLimit`  
5. **命名**：调用 `applyNamingRule`，生成子对象名称  
6. **校验**：调用 `validateDividedObjects`，检查子对象合法性  
7. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **divider_schema.json**（建议字段）：  
  ```json
  {
    "type": "object",
    "properties": {
      "original_name": { "type": "string" },
      "sub_objects": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "vertex_count": { "type": "integer" },
            "face_count": { "type": "integer" }
          },
          "required": ["name","vertex_count","face_count"]
        }
      },
      "max_vertices": { "type": "integer" },
      "max_faces": { "type": "integer" },
      "naming_rule": { "type": "string" }
    },
    "required": ["original_name","sub_objects","max_vertices","max_faces"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_ObjectDividerTools`  
- **按钮**：  
  - `btnDivideObject` → “Divide Object”  
  - `spnMaxVertices` → 设置最大顶点数  
  - `spnMaxFaces` → 设置最大面数  
  - `chkPreserveHierarchy` → 是否保留层级  
  - `ddlNamingRule` → 命名规则选择  

---

## 校验与错误处理
- **常见错误**：  
  - 未选择几何体 → 报错  
  - 顶点/面数限制非法 → 报错  
  - 拆分失败（几何体过于复杂） → 报错  
- **错误码建议**：  
  - 3301：未选择几何体  
  - 3302：参数非法  
  - 3303：拆分失败  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`geometry/object_divider.py`  
- **API 映射**：  
  - `collectGeometry` → `bpy.data.objects[...]` + `mesh.vertices` / `mesh.polygons`  
  - `splitByVertexLimit` / `splitByFaceLimit` → Python 脚本拆分 Mesh（可用 BMesh API）  
  - `applyNamingRule` → Blender 对象命名规则  
- **风险**：  
  - Blender 没有内置“按顶点/面数拆分”功能，需要自研算法  
  - 大规模模型拆分性能需优化  

---

## 测试清单
- 简单立方体 → 不拆分（顶点/面数未超限）  
- 大型模型 → 自动拆分为多个子对象  
- 命名规则 → 子对象命名正确  
- 保留层级 → 子对象保持父子关系  
- 非法参数（负数、零） → 报错  

---

## 风险与 TODO
- 拆分算法实现需团队确认（按面数优先还是顶点数优先）  
- 命名规则需统一（如 `object_01`, `object_02`）  
- 是否需要支持批量拆分多个对象  

---


---

# BigWorld_Prefab_Assembler.mcr 深度报告

## 概述
- **模块职责**：  
  将场景中的多个对象（模型、子节点、挂点等）组合成一个 **Prefab**，并导出为 `.prefab` 文件。Prefab 是一种可复用的资源单元，便于在引擎中快速加载和实例化。  
- **上下文位置**：  
  Prefab 工具类的唯一模块，通常在导出 Visual/Animation/HitBox 之后使用，用于打包完整的资源单元。  

---

## 输入与前置条件
- **输入数据**：  
  - 根节点（Prefab 的主对象）  
  - 子对象集合（模型、挂点、特效节点等）  
  - 变换信息（位置、旋转、缩放）  
  - 是否合并导出为单文件  
  - 导出路径  
- **前置条件**：  
  - Common 模块可用（路径、日志、文件写入工具）  
  - Validator 模块可用（校验 Prefab 数据合法性）  
  - 场景中存在至少一个根节点  

---

## 导出的接口
- **函数**：
  - `assemblePrefab()`：主组装入口  
  - `collectPrefabObjects()`：收集根节点及子对象  
  - `applyTransforms()`：应用位置、旋转、缩放  
  - `mergeObjects()`：可选，合并为单一对象  
  - `writePrefabFile()`：写出 `.prefab` 文件  
  - `validatePrefab()`：调用 Validator 校验  
- **数据结构**：
  - `PrefabData`：包含 prefab_name、root、children、transforms、export_path  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `assemblePrefab()`  
2. **收集对象**：调用 `collectPrefabObjects`  
3. **应用变换**：调用 `applyTransforms`  
4. **合并（可选）**：调用 `mergeObjects`  
5. **校验**：调用 `validatePrefab`，检查结构完整性  
6. **写出文件**：调用 `writePrefabFile`，生成 `.prefab` 文件  
7. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **prefab_schema.json**（建议字段）：  
  ```json
  {
    "type": "object",
    "properties": {
      "prefab_name": { "type": "string" },
      "root": { "type": "string" },
      "children": {
        "type": "array",
        "items": { "type": "string" }
      },
      "transforms": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "object": { "type": "string" },
            "position": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
            "rotation": { "type": "array", "items": { "type": "number" }, "minItems": 4, "maxItems": 4 },
            "scale": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 }
          },
          "required": ["object","position","rotation","scale"]
        }
      },
      "export_path": { "type": "string" }
    },
    "required": ["prefab_name","root","children","export_path"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_PrefabAssemblerTools`  
- **按钮**：  
  - `btnAssemblePrefab` → “Assemble Prefab”  
  - `btnSetRoot` → 设置根节点  
  - `btnAddChild` → 添加子对象  
  - `btnRemoveChild` → 移除子对象  
  - `chkMergeObjects` → 是否合并为单文件  

---

## 校验与错误处理
- **常见错误**：  
  - 未设置根节点 → 报错  
  - 子对象为空 → 报错  
  - 变换数据缺失 → 报错  
  - 导出路径无效 → 报错  
- **错误码建议**：  
  - 3401：未设置根节点  
  - 3402：子对象为空  
  - 3403：变换数据缺失  
  - 3404：路径错误  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`prefab/prefab_assembler.py`  
- **API 映射**：  
  - `collectPrefabObjects` → Blender 中 Collection 或 Parent-Child 关系  
  - `applyTransforms` → `obj.location` / `obj.rotation_quaternion` / `obj.scale`  
  - `mergeObjects` → `bpy.ops.object.join()`  
  - `writePrefabFile` → JSON/XML 写出  
- **风险**：  
  - Blender 中 Prefab 概念需团队定义（推荐 Collection + 自定义属性）  
  - 合并对象可能导致材质丢失，需要额外处理  

---

## 测试清单
- 单根节点 + 多子对象 → 正确组装  
- 应用位置/旋转/缩放 → 正确写入  
- 合并开关 → 导出文件差异  
- 子对象为空 → 报错  
- 导出后 `.prefab` 文件能被引擎正确加载  

---

## 风险与 TODO
- Prefab 在 Blender 中的表示方式需团队确认（Collection vs Empty Root）  
- 合并对象时的材质/UV 保留策略需明确  
- Prefab 文件格式（XML/JSON/二进制）需确认引擎版本  

---

---

# BigWorld_Modify_Res_Paths.mcr 深度报告

## 概述
- **模块职责**：  
  在 3ds Max 场景中批量修改资源路径（贴图、模型、动画等），解决路径错误、目录迁移或资源重构时的引用问题。  
- **上下文位置**：  
  路径工具类的第一个模块，通常与 `Verify_File_Paths.mcr` 配合使用：前者负责修改，后者负责校验。  

---

## 输入与前置条件
- **输入数据**：  
  - 旧路径（OldPath）  
  - 新路径（NewPath）  
  - 路径类型（Texture/Model/Anim）  
  - 是否递归修改子目录  
  - 是否在修改前备份  
- **前置条件**：  
  - Common 模块可用（路径、日志、文件操作）  
  - Validator 模块可用（校验路径合法性）  
  - 场景中存在引用资源  

---

## 导出的接口
- **函数**：
  - `modifyResPaths()`：主修改入口  
  - `findResourcesByPath(oldPath)`：查找引用旧路径的资源  
  - `replaceResourcePath(oldPath,newPath)`：替换路径  
  - `backupResourceFiles()`：修改前备份资源文件  
  - `validatePaths()`：调用 Validator 校验  
- **数据结构**：
  - `ResPathData`：包含 old_path、new_path、path_type、recursive、backup  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `modifyResPaths()`  
2. **查找资源**：调用 `findResourcesByPath`  
3. **备份（可选）**：调用 `backupResourceFiles`  
4. **替换路径**：调用 `replaceResourcePath`  
5. **校验**：调用 `validatePaths`，检查新路径是否存在  
6. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **respath_schema.json**（建议字段）：  
  ```json
  {
    "type": "object",
    "properties": {
      "old_path": { "type": "string" },
      "new_path": { "type": "string" },
      "path_type": { "type": "string", "enum": ["texture","model","anim"] },
      "recursive": { "type": "boolean" },
      "backup": { "type": "boolean" }
    },
    "required": ["old_path","new_path","path_type"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_PathTools`  
- **按钮**：  
  - `btnModifyPaths` → “Modify Paths”  
  - `btnFindResources` → 查找资源  
  - `chkApplyRecursively` → 是否递归  
  - `chkBackupBeforeModify` → 是否备份  

---

## 校验与错误处理
- **常见错误**：  
  - 未指定旧路径/新路径 → 报错  
  - 新路径不存在 → 报错  
  - 替换失败（文件被占用） → 报错  
- **错误码建议**：  
  - 3501：路径缺失  
  - 3502：新路径不存在  
  - 3503：替换失败  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`paths/modify_res_paths.py`  
- **API 映射**：  
  - `findResourcesByPath` → 遍历 `bpy.data.images`、`bpy.data.meshes`、`bpy.data.actions` 等  
  - `replaceResourcePath` → 修改 `image.filepath`、`mesh.library`、`action.library`  
  - `backupResourceFiles` → Python `shutil.copy`  
- **风险**：  
  - Blender 的资源路径可能是相对路径，需要统一策略  
  - 批量修改时需避免破坏 Asset Browser 的引用  

---

## 测试清单
- 修改单个贴图路径 → 正确更新  
- 修改多个模型路径 → 正确更新  
- 递归修改子目录 → 正确覆盖  
- 新路径不存在 → 报错  
- 修改前备份 → 生成备份文件  

---

## 风险与 TODO
- 路径相对/绝对的策略需团队确认  
- 是否支持网络路径（UNC）需确认  
- 备份文件的存放位置需统一规范  

---


---

# BigWorld_Verify_File_Paths.mcr 深度报告

## 概述
- **模块职责**：  
  校验场景中所有资源文件路径的合法性，包括存在性、大小写一致性、相对路径合法性等，避免导出后引擎加载失败。  
- **上下文位置**：  
  路径工具类的最后一个模块，通常与 `Modify_Res_Paths.mcr` 配合使用：前者修改，后者验证。  

---

## 输入与前置条件
- **输入数据**：  
  - 文件路径（单个或批量）  
  - 路径类型（Texture/Model/Anim）  
  - 校验选项（存在性、大小写、相对路径）  
- **前置条件**：  
  - Common 模块可用（路径、日志、文件操作）  
  - Validator 模块可用（校验结果输出）  
  - 场景中存在引用资源  

---

## 导出的接口
- **函数**：
  - `verifyFilePaths()`：主校验入口  
  - `checkExistence(path)`：检查文件是否存在  
  - `checkCaseSensitivity(path)`：检查路径大小写一致性  
  - `checkRelativePaths(path)`：检查相对路径合法性  
  - `reportInvalidPaths()`：输出错误路径报告  
- **数据结构**：
  - `FilePathData`：包含 file_path、path_type、check_existence、check_case、check_relative  

---

## 内部流程与调用关系
1. **用户点击 UI 按钮** → 触发 `verifyFilePaths()`  
2. **遍历路径**：逐个调用 `checkExistence`、`checkCaseSensitivity`、`checkRelativePaths`  
3. **收集结果**：将错误路径存入列表  
4. **输出报告**：调用 `reportInvalidPaths`  
5. **日志**：调用 `log_info` 或 `log_error` 输出结果  

---

## 数据契约与 Schema 对齐
- **filepath_schema.json**（建议字段）：  
  ```json
  {
    "type": "object",
    "properties": {
      "file_path": { "type": "string" },
      "path_type": { "type": "string", "enum": ["texture","model","anim"] },
      "check_existence": { "type": "boolean" },
      "check_case": { "type": "boolean" },
      "check_relative": { "type": "boolean" }
    },
    "required": ["file_path","path_type"],
    "additionalProperties": false
  }
  ```

---

## UI / 指令入口
- **Rollout 面板**：`rollout_VerifyPathsTools`  
- **按钮**：  
  - `btnVerifyPaths` → “Verify Paths”  
  - `chkCheckExistence` → 是否检查存在性  
  - `chkCaseSensitive` → 是否区分大小写  
  - `chkRelativePaths` → 是否检查相对路径  

---

## 校验与错误处理
- **常见错误**：  
  - 文件不存在 → 报错  
  - 路径大小写不一致（Windows/Unix 差异） → 报错  
  - 相对路径非法 → 报错  
- **错误码建议**：  
  - 3601：文件不存在  
  - 3602：大小写错误  
  - 3603：相对路径非法  

---

## 迁移到 Blender 的实现要点
- **Python 模块**：`paths/verify_file_paths.py`  
- **API 映射**：  
  - `checkExistence` → Python `os.path.exists()`  
  - `checkCaseSensitivity` → 自定义函数（在区分大小写的系统上比对实际路径）  
  - `checkRelativePaths` → `os.path.isabs()` 判断 + 项目根目录规则  
  - `reportInvalidPaths` → Blender 控制台或日志面板输出  
- **风险**：  
  - Windows 与 Linux 的大小写敏感性差异  
  - Blender Asset Browser 的路径可能是相对路径，需要统一策略  

---

## 测试清单
- 文件存在 → 校验通过  
- 文件不存在 → 报错  
- 大小写错误（如 `Textures/wood.png` vs `textures/wood.png`） → 报错  
- 相对路径非法 → 报错  
- 批量路径校验 → 输出完整报告  

---

## 风险与 TODO
- 路径大小写校验需跨平台测试（Windows vs Linux）  
- 相对路径策略需团队确认（是否强制相对项目根目录）  
- 报告输出格式需统一（控制台 vs 文件 vs UI 面板）  

---

**所有 BigWorld MaxScript 文件的逐个深度报告已经完成** 🎉。  





---

# 📊 BigWorld 模块依赖关系图（调用关系图）

```
                ┌─────────────────────┐
                │   BigWorld_Startup  │
                │ (初始化/注册UI入口) │
                └─────────┬──────────┘
                          │
                          ▼
                ┌─────────────────────┐
                │   BigWorld_Common   │
                │ (公共常量/工具函数) │
                └─────────┬──────────┘
                          │
                          ▼
                ┌─────────────────────┐
                │ BigWorld_Validator  │
                │ (统一校验/日志系统) │
                └─────────┬──────────┘
                          │
        ┌─────────────────┼───────────────────┐
        │                 │                   │
        ▼                 ▼                   ▼
┌───────────────┐  ┌───────────────┐   ┌────────────────┐
│ Export 系列    │  │ Geometry 系列 │   │ Portal 系列    │
│ (Visual/Anim/ │  │ (BSP/Hull/    │   │ (Exit/Heaven/  │
│ HitBox)       │  │ Normals/Div)  │   │ Standard/Label)│
└───────┬───────┘  └───────┬───────┘   └────────┬───────┘
        │                  │                    │
        ▼                  ▼                    ▼
┌───────────────┐  ┌───────────────┐   ┌────────────────┐
│ Prefab 系列    │  │ Path 系列     │   │ Import 系列    │
│ (Assembler)   │  │ (Modify/Verify)│   │ (HardPoint)    │
└───────────────┘  └───────────────┘   └────────────────┘
```

---

# 🔹 依赖说明

1. **Startup → Common → Validator**  
   - 所有模块都依赖 Common（路径、日志、工具函数）。  
   - 所有导出/几何/Portal/路径模块都依赖 Validator（校验与错误处理）。  

2. **Export 系列**  
   - Visual、Animation、HitBox → 依赖 Common + Validator。  
   - HitBox 导出还依赖 Define_Hitboxes 的数据。  

3. **Geometry 系列**  
   - BSP、Hull、Normals、Divider → 依赖 Common + Validator。  
   - Normals 通常在 Visual 导出前调用。  
   - Divider 在大模型导出前调用。  

4. **Portal 系列**  
   - Exit/Heaven/Standard/Label → 依赖 Common + Validator。  
   - 四类 Portal 结构一致，仅 type 不同。  

5. **Prefab 系列**  
   - Prefab Assembler → 依赖 Export（Visual/Anim/HitBox）和 Import（HardPoint）的结果。  
   - Prefab 是资源打包的最后环节。  

6. **Path 系列**  
   - Modify_Res_Paths → 修改资源路径。  
   - Verify_File_Paths → 校验资源路径。  
   - 两者互为前后处理关系。  

7. **Import 系列**  
   - HardPoint Import → 依赖 Common + Validator。  
   - 导入的 HardPoint 可作为 Prefab 的子对象。  

---

# 🔹 迁移顺序建议（基于依赖关系）

1. **核心层**：Common → Validator  
2. **导出主链路**：Visual → Animation → HitBox  
3. **几何处理**：Normals → Divider → BSP → Hull  
4. **Portal 系列**：Exit → Heaven → Standard → Label  
5. **路径工具**：Modify → Verify  
6. **导入工具**：HardPoint  
7. **Prefab 打包**：Assembler（最后整合所有资源）  

---

 **全局依赖关系图 + 迁移顺序**。  


---

# 📊 BigWorld 模块测试覆盖矩阵

| 模块类别 | 模块名称 | 输入数据 | 输出数据 | 关键校验点 | 测试用例示例 |
|----------|----------|----------|----------|------------|--------------|
| **核心层** | Common | 路径、日志调用 | 工具函数返回值 | 工具函数正确性、日志输出一致性 | 调用路径拼接函数，检查结果是否符合预期 |
|          | Validator | 任意模块数据 | 校验结果（通过/错误码） | 错误码覆盖、边界条件 | 输入非法尺寸 → 返回对应错误码 |
| **导出类** | Export Visual | Mesh、材质、动画引用 | `.visual` 文件 | Mesh 完整性、材质路径正确 | 导出带多材质模型，检查 `.visual` 文件 |
|          | Export Animation | 骨骼、动作数据 | `.animation` 文件 | 骨骼绑定一致性、帧数正确 | 导出动作帧数与 Max 一致 |
|          | Define Hitboxes | 骨骼、尺寸、位置 | HitBox 节点 | 名称唯一性、骨骼存在性 | 创建重复名称 → 报错 |
|          | Export HitBox XML | HitBox 节点 | `.xml` 文件 | 字段完整性、骨骼映射正确 | 导出后 XML 能被引擎加载 |
| **几何类** | Make BSP | Mesh | `.bsp` 文件 | 封闭性、树结构合法性 | 非封闭几何 → 报错 |
|          | Make CustomHull | Mesh | `.hull` 文件 | Hull 类型正确、面数优化 | 凸包/凹壳生成正确 |
|          | Munge Normals | Mesh | 更新后的法线 | 法线方向一致性、平滑角度 | 翻转法线 → 自动修正 |
|          | Object Divider | 大型 Mesh | 多个子对象 | 子对象顶点/面数 ≤ 限制 | 超过 65535 面 → 自动拆分 |
| **Portal 类** | Exit Portal | 位置、法线、尺寸 | Portal 节点 | 法线合法性、尺寸正确 | 法线为零向量 → 报错 |
|          | Heaven Portal | 同上 | Portal 节点 | 类型=heaven | 导出后标记正确 |
|          | Standard Portal | 同上 | Portal 节点 | 类型=standard | 多个 Portal 正确列出 |
|          | Label Portal | 同上 + 标签 | Portal 节点 | 标签唯一性 | 标签为空/重复 → 报错 |
| **路径类** | Modify Res Paths | 旧路径、新路径 | 更新后的路径 | 新路径存在性、替换正确性 | 修改贴图路径后能正确加载 |
|          | Verify File Paths | 文件路径集合 | 校验报告 | 文件存在性、大小写一致性 | Linux 下大小写错误 → 报错 |
| **导入类** | Import HardPoint | `.xml`/`.json` 文件 | HardPoint 节点 | 骨骼存在性、名称唯一性 | 导入挂点绑定到正确骨骼 |
| **Prefab 类** | Prefab Assembler | 根节点、子对象 | `.prefab` 文件 | 结构完整性、变换正确性 | Prefab 导出后能被引擎实例化 |

---

# 🔹 测试覆盖策略

1. **功能覆盖**：每个模块的主要功能（导入/导出/生成/校验）至少有 1 个正向用例 + 1 个反向用例。  
2. **边界覆盖**：顶点数、面数、角度阈值、路径长度等边界条件必须测试。  
3. **错误覆盖**：所有错误码（如 2301, 3102, 3603）必须有对应触发用例。  
4. **集成覆盖**：跨模块链路（如 HitBox 定义 → 导出 XML → Prefab 组装）必须测试全链路一致性。  
5. **平台覆盖**：路径校验需在 Windows/Linux 双平台测试（大小写敏感性）。  

---


---

# 📑 错误码规范表（Error Code Standard）

为了避免各模块随意定义错误码，建议建立一个 **统一的错误码区间分配表**，保证唯一性和可追溯性。

| 模块类别 | 错误码区间 | 示例错误码 | 含义 |
|----------|------------|------------|------|
| **核心层** | 1000–1999 | 1001 | Common 工具函数调用失败 |
|          |            | 1101 | Validator 校验失败（通用） |
| **导出类** | 2000–2499 | 2301 | HitBox 未定义 |
|          |            | 2302 | 骨骼不存在 |
|          |            | 2402 | HitBox 名称重复 |
| **几何类** | 3000–3499 | 3001 | BSP：未选择几何体 |
|          |            | 3102 | Hull：几何体过于复杂 |
|          |            | 3203 | Normals：阈值非法 |
|          |            | 3303 | Divider：拆分失败 |
| **Portal 类** | 2500–2899 | 2501 | Exit Portal：未指定法线 |
|          |            | 2603 | Heaven Portal：名称重复 |
|          |            | 2702 | Standard Portal：尺寸非法 |
|          |            | 2804 | Label Portal：标签错误 |
| **路径类** | 3500–3699 | 3502 | Modify：新路径不存在 |
|          |            | 3602 | Verify：大小写错误 |
| **导入类** | 2900–2999 | 2901 | HardPoint：文件不存在 |
|          |            | 2904 | HardPoint：名称重复 |
| **Prefab 类** | 3400–3499 | 3401 | Prefab：未设置根节点 |
|          |            | 3403 | Prefab：变换数据缺失 |

👉 这样每个模块都有独立的区间，错误码一眼就能定位到模块和问题类型。

---

# 📂 统一的 Schema 仓库（Schema Repository）

建议在项目中建立一个独立目录，例如：

```
/schemas
   /export
      visual_schema.json
      animation_schema.json
      hitbox_schema.json
   /geometry
      bsp_schema.json
      hull_schema.json
      normals_schema.json
      divider_schema.json
   /portal
      portal_exit_schema.json
      portal_heaven_schema.json
      portal_standard_schema.json
      portal_label_schema.json
   /paths
      respath_schema.json
      filepath_schema.json
   /import
      hardpoint_schema.json
   /prefab
      prefab_schema.json
```

## 规范要求
1. **命名规则**：`模块名_schema.json`，保持与代码模块一一对应。  
2. **版本管理**：  
   - 每个 Schema 文件包含 `"schema_version": "v1.0"` 字段。  
   - 修改字段时必须更新版本号，并在 `CHANGELOG.md` 中记录。  
3. **校验工具**：  
   - 在 CI/CD 中使用 `jsonschema` 或 `pydantic` 自动校验导出文件。  
   - 每次提交代码时，自动跑 Schema 校验，防止不符合规范的文件进入仓库。  
4. **文档化**：  
   - 每个 Schema 文件需配套一份 Markdown 文档，说明字段含义、示例、必填项。  
   - 示例：  
     ```json
     {
       "hitbox_name": "head_hitbox",
       "bone": "Bip01_Head",
       "dimensions": [0.2,0.3,0.4],
       "position": [0,1.2,0],
       "rotation": [0,0,0,1],
       "type": "box"
     }
     ```

---

# 🔹 建议的落地步骤

1. **建立 `/schemas` 仓库目录**，初始导入所有模块的 Schema。  
2. **定义错误码表**，放在 `/docs/error_codes.md`，团队统一引用。  
3. **在 CI/CD 中集成 Schema 校验**，保证导出文件符合规范。  
4. **定期版本审查**：每次引擎升级或迁移新功能时，更新 Schema 与错误码。  

---
https://github.com/howarduong/BigWorld_MAXScripts 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MAXScripts/BigWorld_Common.ms 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Cue_Track.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Define_Hitboxes.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Exit_Portal.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Export_Animation.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Export_HitBox_to_xml.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Export_Visual.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Heaven_Portal.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Import_HardPoint.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Label_Portal.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Make_BSP.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Make_CustomHull.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Modify_Res_Paths.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Munge_Normals.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Object_Divider.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Prefab_Assembler.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Standard_Portal.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_MacroScripts/BigWorld_Verify_File_Paths.mcr 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/BigWorld_StartupScripts/BigWorld_Startup.ms 
https://github.com/howarduong/BigWorld_MAXScripts/blob/main/help/BigWorld%20MAXScripts.pdf 