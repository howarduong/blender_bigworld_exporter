# 🧪 BigWorld Exporter 测试指南

**测试版本**: v1.0.0 (重构版)  
**测试日期**: 2025-10-22  
**预计测试时间**: 30分钟

---

## 📋 测试前准备

### 1. 环境检查
- [ ] Blender 4.0或更高版本
- [ ] Python 3.10+
- [ ] 插件已正确安装到 `addons_core/blender_bigworld_exporter/`

### 2. 测试文件准备
准备以下测试模型（可使用示例或自建）：
- [ ] 简单立方体（静态模型）
- [ ] 带骨骼的角色模型（蒙皮模型）
- [ ] 带动画的角色模型（角色动画）

---

## 🔍 测试流程

### 阶段1：插件加载测试（5分钟）

#### 测试1.1：启用插件
1. 打开Blender
2. Edit → Preferences → Add-ons
3. 搜索"BigWorld"
4. 启用插件

**预期结果**:
```
✅ 插件成功启用
✅ 控制台无报错
✅ 显示"BigWorld Exporter 已注册"
```

**如果失败**:
- 检查Python控制台错误信息
- 确认所有文件完整
- 重新加载插件

---

#### 测试1.2：UI显示检测
1. 在3D视口中按`N`键打开侧边栏
2. 查找"BigWorld"标签页

**预期结果**:
```
✅ 出现"BigWorld"标签页
✅ 显示"BigWorld 对象属性"面板
```

---

#### 测试1.3：导出菜单检测
1. File → Export
2. 查找BigWorld导出选项

**预期结果**:
```
✅ 出现"BigWorld (.primitives, .visual, .model)"选项
```

---

### 阶段2：UI功能测试（10分钟）

#### 测试2.1：对象属性面板
1. 选择场景中的一个Mesh对象
2. 在N面板查看"BigWorld 对象属性"

**测试项**:
- [ ] "基础设置"区域显示
  - [ ] 导出类型下拉框（静态/蒙皮/角色）
  - [ ] 资源ID输入框
  - [ ] 父模型输入框（仅蒙皮/角色显示）

- [ ] 切换导出类型为"蒙皮模型"
  - [ ] "硬点管理"区域显示
  - [ ] "Action管理"区域隐藏

- [ ] 切换导出类型为"角色动画"
  - [ ] "硬点管理"区域显示
  - [ ] "Action管理"区域显示

**预期结果**: 所有UI元素根据导出类型动态显示/隐藏

---

#### 测试2.2：Hardpoint管理
1. 导出类型选择"蒙皮模型"
2. 在"硬点管理"区域点击`+`按钮

**测试项**:
- [ ] 添加硬点
  - [ ] 列表中出现新硬点（如"HP_0"）
  - [ ] 选中硬点后下方显示详细设置

- [ ] 配置硬点
  - [ ] 修改硬点名称（如"HP_RightHand"）
  - [ ] 选择硬点类型（武器/装备/特效/交互）
  - [ ] 输入绑定骨骼名称

- [ ] 删除硬点
  - [ ] 选中硬点，点击`-`按钮
  - [ ] 硬点从列表中移除

**预期结果**: 
```
✅ 硬点添加/删除正常
✅ 配置能正确保存
✅ UI图标正确显示
```

---

#### 测试2.3：Action管理
1. 导出类型选择"角色动画"
2. 在"Action管理"区域点击`+`按钮

**测试项**:
- [ ] 添加Action
  - [ ] 列表中出现新Action（如"Action_0"）
  - [ ] 选中Action后下方显示详细设置

- [ ] 配置Action
  - [ ] 修改Action名称（如"WalkForward"）
  - [ ] 输入关联动画名称（如"walk"）
  - [ ] 切换"混合播放"开关
  - [ ] 调整动画轨道（0-10）

- [ ] 移动Action
  - [ ] 添加多个Action
  - [ ] 使用上下箭头调整顺序

- [ ] 删除Action
  - [ ] 选中Action，点击`-`按钮
  - [ ] Action从列表中移除

**预期结果**: 
```
✅ Action添加/删除/移动正常
✅ 配置能正确保存
✅ UI显示正确（名称、动画、混合、轨道）
```

---

#### 测试2.4：导出前检测
1. 配置好对象属性
2. 点击"运行导出前检测"按钮

**测试项**:
- [ ] 静态模型检测
  - [ ] 无Armature时通过
  - [ ] 显示"检测通过"

- [ ] 蒙皮模型检测
  - [ ] 有Armature时通过
  - [ ] 无Armature时报错

- [ ] 角色动画检测
  - [ ] 有Armature和Action时通过
  - [ ] 无Action时显示警告

**预期结果**: 检测功能正常，提示信息准确

---

### 阶段3：导出功能测试（15分钟）

#### 测试3.1：静态模型导出
1. 创建或选择一个简单的Mesh（如Cube）
2. 导出类型：静态模型
3. 资源ID：test_static
4. File → Export → BigWorld
5. 选择导出目录

**检查项**:
- [ ] 导出过程无报错
- [ ] 生成文件：
  - [ ] test_static.primitives
  - [ ] test_static.visual
  - [ ] test_static.model
  - [ ] manifest.json
  - [ ] audit.log

- [ ] 文件内容检查：
  - [ ] .model文件包含`<nodelessVisual>`标签
  - [ ] .model文件不包含hardPoint标签
  - [ ] .model文件不包含action标签

**预期结果**: 静态模型正常导出，文件格式正确

---

#### 测试3.2：蒙皮模型导出（含Hardpoint）
1. 选择一个带Armature的Mesh
2. 导出类型：蒙皮模型
3. 资源ID：test_skinned
4. 添加2个Hardpoint：
   - HP_Mount1（类型：武器，绑定：Bone1）
   - HP_Mount2（类型：装备，绑定：Bone2）
5. 导出

**检查项**:
- [ ] 导出过程无报错
- [ ] 生成文件：
  - [ ] test_skinned.primitives（包含蒙皮数据）
  - [ ] test_skinned.visual（包含骨骼层级）
  - [ ] test_skinned.model
  - [ ] manifest.json
  - [ ] audit.log

- [ ] 文件内容检查：
  - [ ] .model文件包含`<nodefullVisual>`标签
  - [ ] .model文件包含2个`<hardPoint>`标签
  - [ ] 每个hardPoint包含：
    - [ ] `<name>` - 硬点名称
    - [ ] `<identifier>` - 骨骼完整路径
    - [ ] `<transform>` - 4x3变换矩阵

**预期结果**: 蒙皮模型正常导出，Hardpoint数据正确

---

#### 测试3.3：角色动画导出（含Action和Hardpoint）
1. 选择一个带Armature和Action的Mesh
2. 导出类型：角色动画
3. 资源ID：test_character
4. 添加3个Action：
   - WalkForward（动画：walk，混合：是，轨道：0）
   - RunForward（动画：run，混合：是，轨道：0）
   - Attack（动画：attack，混合：否，轨道：1）
5. 添加2个Hardpoint：
   - HP_RightHand（类型：武器，绑定：RightHand）
   - HP_LeftHand（类型：副手，绑定：LeftHand）
6. 导出

**检查项**:
- [ ] 导出过程无报错
- [ ] 生成文件：
  - [ ] test_character.primitives
  - [ ] test_character.visual
  - [ ] test_character.model
  - [ ] animations/walk.animation
  - [ ] animations/run.animation
  - [ ] animations/attack.animation
  - [ ] manifest.json
  - [ ] audit.log

- [ ] 文件内容检查：
  - [ ] .model文件包含`<nodefullVisual>`标签
  - [ ] .model文件包含3个`<animation>`标签
  - [ ] .model文件包含3个`<action>`标签
  - [ ] .model文件包含2个`<hardPoint>`标签
  
  - [ ] 每个action包含：
    - [ ] `<name>` - Action名称
    - [ ] `<animation>` - 关联动画
    - [ ] `<blended>` - 混合标志
    - [ ] `<track>` - 轨道索引

**预期结果**: 角色动画正常导出，Action和Hardpoint数据正确

---

### 阶段4：BigWorld工具验证（可选）

如果有BigWorld官方工具（ModelEditor/WorldEditor）：

#### 测试4.1：ModelEditor加载
1. 使用ModelEditor打开导出的.model文件
2. 检查模型显示
3. 检查骨骼层级
4. 检查Hardpoint位置

**预期结果**: 
```
✅ 模型正常显示，无"乱模"
✅ 骨骼层级正确显示
✅ Hardpoint显示在正确位置
```

---

#### 测试4.2：动画播放
1. 在ModelEditor中播放动画
2. 测试Action切换

**预期结果**: 
```
✅ 动画正常播放
✅ Action可正确切换
✅ 混合播放工作正常
```

---

## 📊 测试结果记录

### 测试环境
- Blender版本: __________
- 操作系统: __________
- 测试日期: __________

### 测试结果汇总

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 插件加载 | ⬜通过 / ⬜失败 | |
| UI显示 | ⬜通过 / ⬜失败 | |
| Hardpoint管理 | ⬜通过 / ⬜失败 | |
| Action管理 | ⬜通过 / ⬜失败 | |
| 静态模型导出 | ⬜通过 / ⬜失败 | |
| 蒙皮模型导出 | ⬜通过 / ⬜失败 | |
| 角色动画导出 | ⬜通过 / ⬜失败 | |
| BigWorld工具验证 | ⬜通过 / ⬜失败 / ⬜跳过 | |

### 发现的问题
1. ___________________________
2. ___________________________
3. ___________________________

### 改进建议
1. ___________________________
2. ___________________________
3. ___________________________

---

## 🐛 常见问题排查

### 问题1：插件无法加载
**症状**: 启用插件时报错  
**排查步骤**:
1. 查看Python控制台错误信息
2. 检查是否有文件缺失
3. 确认Python版本兼容性
4. 重新安装插件

### 问题2：UI不显示
**症状**: N面板中没有BigWorld标签  
**排查步骤**:
1. 确认插件已启用
2. 检查对象是否选中
3. 重启Blender
4. 查看控制台错误

### 问题3：导出报错
**症状**: 导出时出现Python错误  
**排查步骤**:
1. 检查对象是否有Mesh数据
2. 确认Armature绑定正确
3. 查看audit.log日志
4. 检查导出路径权限

### 问题4：.model文件格式错误
**症状**: BigWorld工具无法加载  
**排查步骤**:
1. 用文本编辑器打开.model文件
2. 检查XML格式是否正确
3. 对比官方示例文件
4. 查看插件日志

---

## ✅ 测试通过标准

插件测试通过需满足以下条件：

1. ✅ **基础功能** - 插件正常加载，UI完整显示
2. ✅ **核心功能** - 静态/蒙皮/角色三种导出模式都能正常工作
3. ✅ **新增功能** - Action和Hardpoint能正确添加、配置、导出
4. ✅ **文件格式** - 导出的文件符合BigWorld官方规范
5. ✅ **稳定性** - 无崩溃、无数据丢失、无严重错误

---

**测试完成后，请将结果反馈给开发团队！** 🙏

